
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Unlock the potential of eBPF">
      
      
      
        <link rel="canonical" href="https://eunomia.dev/zh/tutorials/bcc-documents/reference_guide/">
      
      
        <link rel="prev" href="../kernel_config/">
      
      
        <link rel="next" href="../special_filtering/">
      
      
      <link rel="icon" href="../../../../assets/icon.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>bcc 参考指南 - eunomia</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-1YVMXGL0MY"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-1YVMXGL0MY",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-1YVMXGL0MY",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="bcc 参考指南 - eunomia" >
      
        <meta  property="og:description"  content="Unlock the potential of eBPF" >
      
        <meta  property="og:image"  content="https://eunomia.dev/assets/images/social/tutorials/bcc-documents/reference_guide.zh.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://eunomia.dev/zh/tutorials/bcc-documents/reference_guide/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="bcc 参考指南 - eunomia" >
      
        <meta  name="twitter:description"  content="Unlock the potential of eBPF" >
      
        <meta  name="twitter:image"  content="https://eunomia.dev/assets/images/social/tutorials/bcc-documents/reference_guide.zh.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bcc" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../" title="eunomia" class="md-header__button md-logo" aria-label="eunomia" data-md-component="logo">
      
  <img src="../../../../assets/icon.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            eunomia
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              bcc 参考指南
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/en/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/zh/" hreflang="zh" class="md-select__link">
              Chinese
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/eunomia-bpf/eunomia.dev" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../" class="md-tabs__link">
          
  
  
  主页

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  教程

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../blog" class="md-tabs__link">
        
  
  
    
  
  Blog

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../bpftime/" class="md-tabs__link">
          
  
  
  bpftime

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../eunomia-bpf/" class="md-tabs__link">
          
  
  
  eunomia-bpf

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../GPTtrace/" class="md-tabs__link">
          
  
  
  GPTtrace

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../wasm-bpf/" class="md-tabs__link">
          
  
  
  wasm-bpf

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../others/" class="md-tabs__link">
          
  
  
  Ecosystem

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../" title="eunomia" class="md-nav__button md-logo" aria-label="eunomia" data-md-component="logo">
      
  <img src="../../../../assets/icon.svg" alt="logo">

    </a>
    eunomia
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/eunomia-bpf/eunomia.dev" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    主页
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            主页
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Eunomia - Unlock the potential of eBPF
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    教程
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            教程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 开发实践教程：基于 CO-RE，通过小工具快速上手 eBPF 开发
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../0-introduce/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 示例教程 0：核心概念与工具简介
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-helloworld/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门开发实践教程一：Hello World，基本框架和开发流程
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-kprobe-unlink/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门开发实践教程二：在 eBPF 中使用 kprobe 监测捕获 unlink 系统调用
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3-fentry-unlink/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门开发实践教程三：在 eBPF 中使用 fentry 监测捕获 unlink 系统调用
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../4-opensnoop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门开发实践教程四：在 eBPF 中捕获进程打开文件的系统调用集合，使用全局变量过滤进程 pid
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../5-uprobe-bashreadline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门开发实践教程五：在 eBPF 中使用 uprobe 捕获 bash 的 readline 函数调用
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../6-sigsnoop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门开发实践教程六：捕获进程发送信号的系统调用集合，使用 hash map 保存状态
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../7-execsnoop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门实践教程七：捕获进程执行事件，通过 perf event array 向用户态打印输出
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../8-exitsnoop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门开发实践教程八：在 eBPF 中使用 exitsnoop 监控进程退出事件，使用 ring buffer 向用户态打印输出
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-runqlat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门开发实践教程九：捕获进程调度延迟，以直方图方式记录
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../10-hardirqs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门开发实践教程十：在 eBPF 中使用 hardirqs 或 softirqs 捕获中断事件
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../11-bootstrap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门开发实践教程十一：在 eBPF 中使用 libbpf 开发用户态程序并跟踪 exec() 和 exit() 系统调用
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../12-profile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门实践教程十二：使用 eBPF 程序 profile 进行性能分析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../13-tcpconnlat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF入门开发实践教程十三：统计 TCP 连接延时，并使用 libbpf 在用户态处理数据
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../14-tcpstates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF入门实践教程十四：记录 TCP 连接状态与 TCP RTT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../15-javagc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门实践教程十五：使用 USDT 捕获用户态 Java GC 事件耗时
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../16-memleak/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门实践教程十六：编写 eBPF 程序 Memleak 监控内存泄漏
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../17-biopattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门实践教程十七：编写 eBPF 程序统计随机/顺序磁盘 I/O
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../18-further-reading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    更多的参考资料：论文、项目等等
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../19-lsm-connect/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门实践教程：使用 LSM 进行安全检测防御
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../20-tc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门实践教程二十：使用 eBPF 进行 tc 流量控制
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../21-xdp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门实践教程二十一： 使用 XDP 进行可编程数据包处理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../22-android/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    在 Android 上使用 eBPF 程序
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../23-http/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    通过 eBPF socket filter 或 syscall trace 追踪 HTTP 请求等七层协议 - eBPF 实践教程
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../24-hide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 开发实践：使用 eBPF 隐藏进程或文件信息
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../25-signal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 入门实践教程：用 bpf_send_signal 发送信号终止恶意进程
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../26-sudo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用 eBPF 添加 sudo 用户
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../27-replace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用 eBPF 替换任意程序读取或写入的文本
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../28-detach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    在应用程序退出后运行 eBPF 程序：eBPF 程序的生命周期
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../29-sockops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 开发实践：使用 sockops 加速网络请求转发
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../30-sslsniff/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 实践教程：使用 uprobe 捕获多种库的 SSL/TLS 明文数据
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../31-goroutine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 实践教程：使用 eBPF 跟踪 Go 协程状态
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/32-http2/README.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    None
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../33-funclatency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用 eBPF 测量函数延迟
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../34-syscall/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 开发实践：使用 eBPF 修改系统调用参数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../35-user-ringbuf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF开发实践：使用 user ring buffer 向内核异步发送信息
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../36-userspace-ebpf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    用户空间 eBPF 运行时：深度解析与应用实践
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../37-uprobe-rust/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 实践：使用 Uprobe 追踪用户态 Rust 应用
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../38-btf-uprobe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    借助 eBPF 和 BTF，让用户态也能一次编译、到处运行
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../39-nginx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用 eBPF 跟踪 Nginx 请求
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../40-mysql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用 eBPF 跟踪 MySQL 查询
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../41-xdp-tcpdump/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 示例教程：使用 XDP 捕获 TCP 信息
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../42-xdp-loadbalancer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 开发者教程： 简单的 XDP 负载均衡器
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../43-kfuncs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    超越 eBPF 的极限：在内核模块中定义自定义 kfunc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../44-scx-simple/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 教程：BPF 调度器入门
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../45-scx-nest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 示例教程：实现 scx_nest 调度器
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../46-xdp-test/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    xdp-pktgen: xdp based packet generator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../47-cuda-events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 与机器学习可观测：追踪 CUDA GPU 操作
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../48-energy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 教程：进程级能源监控与功耗分析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 开发实践教程：基于 CO-RE，通过小工具快速上手 eBPF 开发
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../18-further-reading/ebpf-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF 运行时安全性：面临的挑战与前沿创新
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../38-btf-uprobe/test-verify/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    using BTF to verify userspace eBPF extensions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../38-btf-uprobe/test-verify/minimal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    minimal examples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../38-btf-uprobe/test-verify/module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    write a basic kernel module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../42-xdp-loadbalancer/connect/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network setup for bpf-developer-tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kernel-versions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linux 内核版本的 BPF 功能
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kernel_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BPF 特性的内核配置
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    bcc 参考指南
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    bcc 参考指南
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      目录
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../special_filtering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    特殊过滤
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bcc 教程
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_bcc_python_developer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bcc Python 开发者教程
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bpftrace-tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bpftrace一行教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../blog" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    bpftime
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            bpftime
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bpftime Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/documents/build-and-test/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building and Test
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/documents/usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Manual
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/documents/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples &amp; Use Cases
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/documents/available-features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Available kernel features in userspace
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Bpftime
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Bpftime
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/llvmbpf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Userspace eBPF VM with LLVM JIT/AOT Compiler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_6_2" >
        
          
          <label class="md-nav__link" for="__nav_4_6_2" id="__nav_4_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    EIM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_2">
            <span class="md-nav__icon md-icon"></span>
            EIM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/EIM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EIM: Extension Interface Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/EIM/example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EIM: Example code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/EIM/spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EIM: Extension Interface Model Specification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/EIM/uprobe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UProbe Role Definition README
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/EIM/usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EIM Usage and people involved (Draft v1)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_6_2_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6_2_6" id="__nav_4_6_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Draft spec
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_6_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_2_6">
            <span class="md-nav__icon md-icon"></span>
            Draft spec
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/EIM/draft-spec/current-EIM-lack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EIM on verify: what can it do and what cannot
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/EIM/draft-spec/spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extension Inferface Model Specification V3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/EIM/draft-spec/spec_core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spec core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/EIM/draft-spec/spec_old/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extension Model Specification V1
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_6_2_7" >
        
          
          <label class="md-nav__link" for="__nav_4_6_2_7" id="__nav_4_6_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Study
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_6_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_2_7">
            <span class="md-nav__icon md-icon"></span>
            Study
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/EIM/study/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    studies on bugs in extensions/plugins
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/EIM/study/browser-ide-bug-study/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    关于浏览器扩展和 IDE 插件漏洞的研究
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/EIM/study/compare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extension Systems compare with EIM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/EIM/study/db-bug-study/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    关于数据库和 Web 服务器扩展接口中的缺陷研究
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/EIM/study/docker-vm-bug-study/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    关于虚拟机管理程序和容器扩展漏洞的研究（2018–2024）
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/EIM/study/game-office-bug-study/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    关于生产力软件和游戏扩展/插件漏洞的案例研究（2018–2024）
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_6_3" >
        
          
          <label class="md-nav__link" for="__nav_4_6_3" id="__nav_4_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    文档
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_3">
            <span class="md-nav__icon md-icon"></span>
            文档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/documents/attach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Detailed Implementation of the Attach Part
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/documents/bpftimeaot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bpftime-aot cli
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/documents/bpftimetool/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bpftimetool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/documents/co-re/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compile Once, Run Everywhere(CO-RE)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/documents/contact/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contact and citations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/documents/how-it-works/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The design and implementation of bpftime
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/documents/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    简介
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bpftime/documents/performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    performance and benchmark
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    eunomia-bpf
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            eunomia-bpf
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eunomia-bpf：简化并增强eBPF，支持CO-RE和WebAssembly
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Eunomia bpf
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Eunomia bpf
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/benchmark/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    benchmark
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/manual/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eunomia-bpf 用户手册: 让 eBPF 程序的开发和部署尽可能简单
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/online/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    在线体验网站
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/supporting-external-BTF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    supporting-external-BTF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/video/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    video
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_8" >
        
          
          <label class="md-nav__link" for="__nav_5_2_8" id="__nav_5_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    项目架构
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_8">
            <span class="md-nav__icon md-icon"></span>
            项目架构
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project architecture
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_9" >
        
          
          <label class="md-nav__link" for="__nav_5_2_9" id="__nav_5_2_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ecc
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_9">
            <span class="md-nav__icon md-icon"></span>
            Ecc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/ecc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eunomia-cc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/ecc/docker-usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ecc docker usage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/ecc/github-template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    github template
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/ecc/usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ecc usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_10" >
        
          
          <label class="md-nav__link" for="__nav_5_2_10" id="__nav_5_2_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ecli
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_10">
            <span class="md-nav__icon md-icon"></span>
            Ecli
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/ecli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ecli
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/ecli/ecli-dockerfile-usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ecli dockerfile usage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/ecli/server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ecli server
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_11" >
        
          
          <label class="md-nav__link" for="__nav_5_2_11" id="__nav_5_2_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Exporter
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_11">
            <span class="md-nav__icon md-icon"></span>
            Exporter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/exporter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    exporter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/exporter/usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    usage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_12" >
        
          
          <label class="md-nav__link" for="__nav_5_2_12" id="__nav_5_2_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Setup
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_12">
            <span class="md-nav__icon md-icon"></span>
            Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/setup/build-android-arm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    build on android aarch64
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../eunomia-bpf/setup/build/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    build from source
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    GPTtrace
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            GPTtrace
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../GPTtrace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GPTtrace 文档
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    GPTtrace
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            GPTtrace
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../GPTtrace/mcptrace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MCPtrace：使用bpftrace进行AI驱动的内核调试
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    wasm-bpf
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            wasm-bpf
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../wasm-bpf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Wasm-bpf Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ecosystem
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Ecosystem
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ecosystem & Other Projects
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Others
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            Others
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/bpf-benchmark/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BPF-Benchmark
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/bpf-compatible/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bpf-compatible
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/contribute/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing to eunomia-bpf
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/ebpf-gpts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    An experiment: GPTs for eBPF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/ideas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Possible ideas for the future
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/usecases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ebpf usecases analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_7" >
        
          
          <label class="md-nav__link" for="__nav_8_2_7" id="__nav_8_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cuda tutorial
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_7">
            <span class="md-nav__icon md-icon"></span>
            Cuda tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    basic-cuda-tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/01-vector-addition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUDA 基础示例 - 向量加法解释
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/02-ptx-assembly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUDA PTX示例：使用内联PTX汇编进行向量乘法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/03-gpu-programming-methods/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUDA编程方法比较：矩阵乘法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/04-gpu-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUDA GPU组织层次结构
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/05-neural-network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用CUDA在GPU上实现神经网络前向传播
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/06-cnn-convolution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用共享内存优化的GPU加速卷积操作
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/07-attention-mechanism/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用CUDA实现Transformer模型的注意力机制
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/08-profiling-tracing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUDA GPU性能分析与跟踪
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/09-gpu-extension/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GPU应用程序扩展机制：无需更改源代码修改行为
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/10-cpu-gpu-profiling-boundaries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CPU和GPU分析边界：在哪里测量什么
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/11-fine-grained-gpu-modifications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    细粒度GPU代码修改
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/12-advanced-gpu-customizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    高级GPU定制技术
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/13-low-latency-gpu-packet-processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    低延迟GPU数据包处理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/14-cuda-function-annotations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUDA函数类型注解：全面指南
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/15-opencl-vector-addition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenCL基础示例 - 向量加法解释
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cuda-tutorial/README_PTX_Demo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PTX文件加载和执行演示
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8" id="__nav_8_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cupti tutorial
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8">
            <span class="md-nav__icon md-icon"></span>
            Cupti tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NVIDIA CUPTI Tutorials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_2" id="__nav_8_2_8_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Activity trace
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_2">
            <span class="md-nav__icon md-icon"></span>
            Activity trace
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/activity_trace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 活动跟踪教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_3" id="__nav_8_2_8_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Activity trace async
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_3">
            <span class="md-nav__icon md-icon"></span>
            Activity trace async
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/activity_trace_async/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 异步活动跟踪教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_4" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_4" id="__nav_8_2_8_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Autorange profiling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_4">
            <span class="md-nav__icon md-icon"></span>
            Autorange profiling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/autorange_profiling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 自动范围性能分析教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_5" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_5" id="__nav_8_2_8_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Callback event
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_5">
            <span class="md-nav__icon md-icon"></span>
            Callback event
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/callback_event/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 回调事件教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_6" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_6" id="__nav_8_2_8_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Callback metric
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_6">
            <span class="md-nav__icon md-icon"></span>
            Callback metric
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/callback_metric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 性能指标教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_7" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_7" id="__nav_8_2_8_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Callback profiling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_7">
            <span class="md-nav__icon md-icon"></span>
            Callback profiling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/callback_profiling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 基于回调的性能分析教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_8" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_8" id="__nav_8_2_8_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Callback timestamp
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_8">
            <span class="md-nav__icon md-icon"></span>
            Callback timestamp
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/callback_timestamp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 时间戳回调教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_9" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_9" id="__nav_8_2_8_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Checkpoint kernels
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_9">
            <span class="md-nav__icon md-icon"></span>
            Checkpoint kernels
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/checkpoint_kernels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 检查点 API 教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_10" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_10" id="__nav_8_2_8_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Common
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_10">
            <span class="md-nav__icon md-icon"></span>
            Common
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/common/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 通用辅助文件
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_11" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_11" id="__nav_8_2_8_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Concurrent profiling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_11">
            <span class="md-nav__icon md-icon"></span>
            Concurrent profiling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/concurrent_profiling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 并发分析教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_12" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_12" id="__nav_8_2_8_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cuda graphs trace
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_12">
            <span class="md-nav__icon md-icon"></span>
            Cuda graphs trace
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/cuda_graphs_trace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUDA 图追踪教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_13" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_13" id="__nav_8_2_8_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cuda memory trace
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_13">
            <span class="md-nav__icon md-icon"></span>
            Cuda memory trace
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/cuda_memory_trace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUDA 内存追踪教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_14" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_14" id="__nav_8_2_8_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cupti correlation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_14">
            <span class="md-nav__icon md-icon"></span>
            Cupti correlation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/cupti_correlation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI API-GPU 活动关联教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_15" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_15" id="__nav_8_2_8_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cupti external correlation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_15">
            <span class="md-nav__icon md-icon"></span>
            Cupti external correlation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/cupti_external_correlation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 外部关联教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_16" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_16" id="__nav_8_2_8_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cupti finalize
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_16">
            <span class="md-nav__icon md-icon"></span>
            Cupti finalize
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/cupti_finalize/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 终结和清理教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_17" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_17" id="__nav_8_2_8_17_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cupti metric properties
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_17">
            <span class="md-nav__icon md-icon"></span>
            Cupti metric properties
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/cupti_metric_properties/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 指标属性教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_18" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_18" id="__nav_8_2_8_18_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cupti nvtx
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_18">
            <span class="md-nav__icon md-icon"></span>
            Cupti nvtx
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/cupti_nvtx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI NVTX 集成教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_19" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_19" id="__nav_8_2_8_19_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cupti query
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_19">
            <span class="md-nav__icon md-icon"></span>
            Cupti query
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/cupti_query/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 查询 API 教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_20" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_20" id="__nav_8_2_8_20_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cupti trace injection
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_20_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_20">
            <span class="md-nav__icon md-icon"></span>
            Cupti trace injection
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/cupti_trace_injection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 跟踪注入教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_21" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_21" id="__nav_8_2_8_21_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Event multi gpu
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_21_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_21">
            <span class="md-nav__icon md-icon"></span>
            Event multi gpu
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/event_multi_gpu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 多 GPU 事件分析教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_22" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_22" id="__nav_8_2_8_22_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Event sampling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_22_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_22">
            <span class="md-nav__icon md-icon"></span>
            Event sampling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/event_sampling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 事件采样教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_23" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_23" id="__nav_8_2_8_23_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Extensions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_23_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_23">
            <span class="md-nav__icon md-icon"></span>
            Extensions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/extensions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 扩展工具
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_24" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_24" id="__nav_8_2_8_24_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Nested range profiling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_24_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_24">
            <span class="md-nav__icon md-icon"></span>
            Nested range profiling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/nested_range_profiling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 嵌套范围分析教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_25" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_25" id="__nav_8_2_8_25_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Nvlink bandwidth
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_25_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_25">
            <span class="md-nav__icon md-icon"></span>
            Nvlink bandwidth
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/nvlink_bandwidth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI NVLink 带宽监控教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_26" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_26" id="__nav_8_2_8_26_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Openacc trace
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_26_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_26">
            <span class="md-nav__icon md-icon"></span>
            Openacc trace
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/openacc_trace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI OpenACC 跟踪教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_27" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_27" id="__nav_8_2_8_27_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pc sampling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_27_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_27">
            <span class="md-nav__icon md-icon"></span>
            Pc sampling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/pc_sampling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI PC 采样教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_28" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_28" id="__nav_8_2_8_28_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pc sampling continuous
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_28_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_28">
            <span class="md-nav__icon md-icon"></span>
            Pc sampling continuous
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/pc_sampling_continuous/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 程序计数器 (PC) 连续采样教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_29" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_29" id="__nav_8_2_8_29_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pc sampling start stop
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_29_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_29">
            <span class="md-nav__icon md-icon"></span>
            Pc sampling start stop
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/pc_sampling_start_stop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI PC 采样启动/停止控制教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_30" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_30" id="__nav_8_2_8_30_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pc sampling utility
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_30_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_30">
            <span class="md-nav__icon md-icon"></span>
            Pc sampling utility
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/pc_sampling_utility/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI PC 采样分析工具教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_31" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_31" id="__nav_8_2_8_31_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pm sampling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_31_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_31">
            <span class="md-nav__icon md-icon"></span>
            Pm sampling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/pm_sampling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    性能监控采样教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_32" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_32" id="__nav_8_2_8_32_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Profiling injection
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_32_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_32">
            <span class="md-nav__icon md-icon"></span>
            Profiling injection
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/profiling_injection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 分析 API 注入教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_33" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_33" id="__nav_8_2_8_33_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Range profiling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_33_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_33">
            <span class="md-nav__icon md-icon"></span>
            Range profiling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/range_profiling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 范围性能分析教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_34" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_34" id="__nav_8_2_8_34_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Sass metrics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_34_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_34">
            <span class="md-nav__icon md-icon"></span>
            Sass metrics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/sass_metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SASS 指标收集教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_35" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_35" id="__nav_8_2_8_35_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Sass source map
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_35_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_35">
            <span class="md-nav__icon md-icon"></span>
            Sass source map
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/sass_source_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI SASS 源代码映射教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_36" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_36" id="__nav_8_2_8_36_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Unified memory
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_36_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_36">
            <span class="md-nav__icon md-icon"></span>
            Unified memory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/unified_memory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 统一内存分析教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_8_37" >
        
          
          <label class="md-nav__link" for="__nav_8_2_8_37" id="__nav_8_2_8_37_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Userrange profiling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_8_2_8_37_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_8_37">
            <span class="md-nav__icon md-icon"></span>
            Userrange profiling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/cupti-tutorial/userrange_profiling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CUPTI 用户范围分析教程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2_9" >
        
          
          <label class="md-nav__link" for="__nav_8_2_9" id="__nav_8_2_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Miscellaneous
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_9">
            <span class="md-nav__icon md-icon"></span>
            Miscellaneous
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/bpftime-kubecon-draft/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF and Wasm: Unifying Userspace Extensions With Bpftime - Yusheng Zheng, eunomia-bpf
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/bpftime-roadmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About bpftime - bpftime ideas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/ebpf-fuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    基于内核态/用户态 eBPF 实现高性能用户态文件系统功能 - 操作系统大赛赛题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/ebpf-gpu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用 eBPF 对 AI/ML 工作负载进行追踪和性能分析 - 操作系统大赛赛题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/ebpf-linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project Proposal for bpftime - eBPF Foundation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/ebpf-lsm-usm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    实现内核与用户态共同工作的 eBPF 安全框架 - 操作系统大赛赛题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/ebpf-usecases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Categorization of eBPF Hooks and Use Cases
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/ebpf-userspace-port/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    将用户态 eBPF 扩展到 MacOS、Windows、FreeBSD 等更多平台 - 操作系统大赛赛题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/ebpf-uxdp-workshop-talk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    uXDP: Frictionless XDP Deployments in Userspace (12-min talk)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/gsoc-ospp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GSOC - OSPP draft proposal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/ideas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    开源活动的可能想法 - eunomia-bpf 2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/linux-plumbers-talk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bpftime talk at linux plumbers 2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/osdi-talk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Speech Script for OSDI 2025 bpftime talk "Extending Applications Safely and Efficiently"
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/roadmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bpftime roadmap and ideas for 2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/talk-ebpf-summit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eBPF Summit 2025 bpftime talk
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/wasm-bpf-kubecon/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Securing and Simplifying eBPF Deployments with WebAssembly
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../others/miscellaneous/wasm-bpf-talk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    talk draft in kubecon
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      目录
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/eunomia-bpf/eunomia.dev/tree/main/docs/tutorials/bcc-documents/reference_guide.zh.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="bcc">bcc 参考指南</h1>
<p>用于搜索 (Ctrl-F) 和参考。如需教程，请从 <a href="../tutorial/">tutorial.md</a> 开始。</p>
<p>该指南尚未完成。如果感觉有遗漏的内容，请查看 bcc 和内核源码。如果确认确实有遗漏，请发送拉取请求进行修复，并协助所有人。</p>
<h2 id="_1">目录</h2>
<ul>
<li><a href="#bcc-参考指南">bcc 参考指南</a></li>
<li><a href="#目录">目录</a></li>
<li><a href="#bpf-c">BPF C</a></li>
<li><a href="#events--arguments">Events \&amp; Arguments</a><ul>
<li><a href="#1-kprobes">1. kprobes</a></li>
<li><a href="#2-kretprobes">2. kretprobes</a></li>
<li><a href="#3-tracepoints">3. Tracepoints</a></li>
<li><a href="#4-uprobes">4. uprobes</a></li>
<li><a href="#6-usdt探测点">6. USDT探测点</a></li>
<li><a href="#7-原始跟踪点">7. 原始跟踪点</a></li>
<li><a href="#8-系统调用跟踪点">8. 系统调用跟踪点</a></li>
<li><a href="#9-kfuncs">9. kfuncs</a></li>
<li><a href="#10-kretfuncs">10. kretfuncs</a></li>
<li><a href="#11-lsm-probes">11. LSM Probes</a></li>
<li><a href="#12-bpf迭代器">12. BPF迭代器</a></li>
</ul>
</li>
<li><a href="#数据">数据</a><ul>
<li><a href="#1-bpf_probe_read_kernel">1. bpf_probe_read_kernel()</a></li>
<li><a href="#2-bpf_probe_read_kernel_strshell">2. bpf_probe_read_kernel_str()".```shell</a></li>
<li><a href="#3-bpf_ktime_get_ns">3. bpf_ktime_get_ns()</a></li>
<li><a href="#4-bpf_get_current_pid_tgid">4. bpf_get_current_pid_tgid()</a></li>
<li><a href="#5-bpf_get_current_uid_gid">5. bpf_get_current_uid_gid()</a></li>
<li><a href="#6-bpf_get_current_comm">6. bpf_get_current_comm()</a></li>
<li><a href="#7-bpf_get_current_task">7. bpf_get_current_task()</a></li>
<li><a href="#8-bpf_log2l">8. bpf_log2l()</a></li>
<li><a href="#9-bpf_get_prandom_u32">9. bpf_get_prandom_u32()</a></li>
<li><a href="#10-bpf_probe_read_user">10. bpf_probe_read_user()</a></li>
<li><a href="#11-bpf_probe_read_user_str">11. bpf_probe_read_user_str()</a></li>
<li><a href="#12-bpf_get_ns_current_pid_tgid">12. bpf_get_ns_current_pid_tgid()</a></li>
</ul>
</li>
<li><a href="#调试">调试</a><ul>
<li><a href="#1-bpf_override_return">1. bpf_override_return()</a></li>
</ul>
</li>
<li><a href="#输出">输出</a><ul>
<li><a href="#1-bpf_trace_printk">1. bpf_trace_printk()</a></li>
<li><a href="#2-bpf_perf_output">2. BPF_PERF_OUTPUT</a></li>
<li><a href="#3-perf_submit">3. perf_submit()</a></li>
<li><a href="#4-perf_submit_skb">4. perf_submit_skb()</a></li>
<li><a href="#5-bpf_ringbuf_output">5. BPF_RINGBUF_OUTPUT</a></li>
<li><a href="#6-ringbuf_output">6. ringbuf_output（）</a></li>
<li><a href="#7-ringbuf_reserve">7. ringbuf_reserve()</a></li>
<li><a href="#8-ringbuf_submit">8. ringbuf_submit（）</a></li>
<li><a href="#9-ringbuf_discard">9. ringbuf_discard()</a></li>
</ul>
</li>
<li><a href="#maps">Maps</a><ul>
<li><a href="#1-bpf_table">1. BPF_TABLE</a></li>
<li><a href="#固定映射">固定映射</a></li>
<li><a href="#2-bpf_hash">2. BPF_HASH</a></li>
<li><a href="#3-bpf_array">3. BPF_ARRAY</a></li>
<li><a href="#4-bpf_histogram">4. BPF_HISTOGRAM</a></li>
<li><a href="#5-bpf_stack_trace">5. BPF_STACK_TRACE</a></li>
<li><a href="#6-bpf_perf_array">6. BPF_PERF_ARRAY</a></li>
<li><a href="#7-bpf_percpu_hash">7. BPF_PERCPU_HASH</a></li>
<li><a href="#8-bpf_percpu_array">8. BPF_PERCPU_ARRAY</a></li>
<li><a href="#9-bpf_lpm_trie">9. BPF_LPM_TRIE</a></li>
<li><a href="#10-bpf_prog_array">10. BPF_PROG_ARRAY</a></li>
<li><a href="#11-bpf_devmap">11. BPF_DEVMAP</a></li>
<li><a href="#12-bpf_cpumap">12. BPF_CPUMAP</a></li>
<li><a href="#13-bpf_xskmap">13. BPF_XSKMAP</a></li>
<li><a href="#14-bpf_array_of_maps">14. BPF_ARRAY_OF_MAPS</a></li>
<li><a href="#15-bpf_hash_of_maps">15. BPF_HASH_OF_MAPS</a></li>
<li><a href="#16-bpf_stack">16. BPF_STACK</a></li>
<li><a href="#17-bpf_queue">17. BPF_QUEUE</a></li>
<li><a href="#18-bpf_sockhash">18. BPF_SOCKHASH</a></li>
<li><a href="#19-maplookup">19. map.lookup()</a></li>
<li><a href="#20-maplookup_or_try_init">20. map.lookup_or_try_init()</a></li>
<li><a href="#21-mapdelete">21. map.delete()</a></li>
<li><a href="#22-mapupdate">22. map.update()</a></li>
<li><a href="#23-mapinsert">23. map.insert()</a></li>
<li><a href="#24-mapincrement">24. map.increment()</a></li>
<li><a href="#25-mapget_stackid">25. map.get_stackid()</a></li>
<li><a href="#26-mapperf_read">26. map.perf_read()</a></li>
<li><a href="#27-mapcall">27. map.call()</a></li>
<li><a href="#28-mapredirect_map">28. map.redirect_map()</a></li>
<li><a href="#29-mappush">29. map.push()</a></li>
<li><a href="#30-mappop">30. map.pop()</a></li>
<li><a href="#31-mappeek">31. map.peek()</a></li>
<li><a href="#32-mapsock_hash_update">32. map.sock_hash_update()</a></li>
<li><a href="#33-mapmsg_redirect_hash">33. map.msg_redirect_hash()</a></li>
<li><a href="#34-mapsk_redirect_hash">34. map.sk_redirect_hash()</a></li>
</ul>
</li>
<li><a href="#许可证">许可证</a></li>
<li><a href="#rewriter">Rewriter</a></li>
<li><a href="#bcc-python">bcc Python</a></li>
<li><a href="#初始化">初始化</a><ul>
<li><a href="#1-bpf">1. BPF</a></li>
</ul>
</li>
<li><a href="#事件">事件</a><ul>
<li><a href="#1-attach_kprobe">1. attach_kprobe()</a></li>
<li><a href="#2-attach_kretprobe">2. attach_kretprobe()</a></li>
<li><a href="#3-attach_tracepoint">3. attach_tracepoint()</a></li>
<li><a href="#4-attach_uprobe">4. attach_uprobe()</a></li>
<li><a href="#5-attach_uretprobe">5. attach_uretprobe()</a></li>
<li><a href="#6-usdtenable_probe">6. USDT.enable_probe()</a></li>
<li><a href="#7-attach_raw_tracepoint">7. attach_raw_tracepoint()</a></li>
<li><a href="#8-attach_raw_socket">8. attach_raw_socket()</a></li>
<li><a href="#9-attach_xdp">9. attach_xdp()</a></li>
<li><a href="#1-xdp_flags_update_if_noexist">1. XDP_FLAGS_UPDATE_IF_NOEXIST</a></li>
<li><a href="#2-xdp_flags_skb_mode">2. XDP_FLAGS_SKB_MODE</a></li>
<li><a href="#3-xdp_flags_drv_mode">3. XDP_FLAGS_DRV_MODE</a></li>
<li><a href="#4-xdp_flags_hw_mode">4. XDP_FLAGS_HW_MODE</a></li>
<li><a href="#10-attach_func">10. attach_func()</a></li>
<li><a href="#12-detach_kprobe">12. detach_kprobe()</a></li>
<li><a href="#13-detach_kretprobe">13. detach_kretprobe()</a></li>
</ul>
</li>
<li><a href="#调试输出">调试输出</a><ul>
<li><a href="#1-trace_print">1. trace_print()</a></li>
<li><a href="#2-trace_fields">2. trace_fields()</a></li>
</ul>
</li>
<li><a href="#输出-api">输出 API</a><ul>
<li><a href="#1-perf_buffer_poll">1. perf_buffer_poll()</a></li>
<li><a href="#2-ring_buffer_poll">2. ring_buffer_poll()</a></li>
<li><a href="#3-ring_buffer_consume">3. ring_buffer_consume()</a></li>
</ul>
</li>
<li><a href="#map-apis">Map APIs</a><ul>
<li><a href="#1-get_table">1. get_table()</a></li>
<li><a href="#2-open_perf_buffer">2. open_perf_buffer()</a></li>
<li><a href="#4-values">4. values()</a></li>
<li><a href="#5-clear">5. clear()</a></li>
<li><a href="#6-items_lookup_and_delete_batch">6. items_lookup_and_delete_batch()</a></li>
<li><a href="#7-items_lookup_batch">7. items_lookup_batch()</a></li>
<li><a href="#8-items_delete_batch">8. items_delete_batch()</a></li>
<li><a href="#9-items_update_batch">9. items_update_batch()</a></li>
<li><a href="#11-print_linear_hist语法-tableprint_linear_histval_typevalue-section_headerbucket-ptr-section_print_fnnone">11. print_linear_hist()".语法: <code>table.print_linear_hist(val_type="value", section_header="Bucket ptr", section_print_fn=None)</code></a></li>
<li><a href="#12-open_ring_buffer">12. open_ring_buffer()</a></li>
<li><a href="#13-push">13. push()</a></li>
<li><a href="#14-pop">14. pop()</a></li>
<li><a href="#15-peek">15. peek()</a></li>
</ul>
</li>
<li><a href="#辅助方法">辅助方法</a><ul>
<li><a href="#1-ksym">1. ksym()</a></li>
<li><a href="#2-ksymname">2. ksymname()</a></li>
<li><a href="#3-sym">3. sym()</a></li>
<li><a href="#4-num_open_kprobes">4. num_open_kprobes()</a></li>
<li><a href="#5-get_syscall_fnname">5. get_syscall_fnname()</a></li>
</ul>
</li>
<li><a href="#bpf-错误">BPF 错误</a></li>
<li><a href="#1-invalid-mem-access">1. Invalid mem access</a></li>
<li><a href="#2-无法从专有程序调用-gpl-only-函数">2. 无法从专有程序调用 GPL-only 函数</a></li>
<li><a href="#环境变量">环境变量</a></li>
<li><a href="#1-内核源代码目录">1. 内核源代码目录</a></li>
<li><a href="#2-内核版本覆盖">2. 内核版本覆盖</a></li>
</ul>
<h1 id="bpf-c">BPF C</h1>
<p>本节介绍了 bcc 程序的 C 部分。</p>
<h2 id="events-arguments">Events &amp; Arguments</h2>
<h3 id="1-kprobes">1. kprobes</h3>
<p>语法：kprobe__<em>kernel_function_name</em></p>
<p><code>kprobe__</code> 是一个特殊的前缀，用于创建一个 kprobe（对内核函数调用的动态跟踪），后面跟着的是内核函数的名称。你也可以通过声明一个普通的 C 函数，然后使用 Python 的 <code>BPF.attach_kprobe()</code>（稍后会介绍）将其与一个内核函数关联起来来使用 kprobe。</p>
<p>参数在函数声明中指定：kprobe__<em>kernel_function_name</em>(struct pt_regs <em>ctx [, </em>argument1* ...])</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">kprobe__tcp_v4_connect</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">pt_regs</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">sock</span><span class="w"> </span><span class="o">*</span><span class="n">sk</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="p">[...]</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">}</span>
</code></pre></div>
<p>这会使用 kprobe 对 tcp_v4_connect() 内核函数进行插装，并使用以下参数：</p>
<ul>
<li><code>struct pt_regs *ctx</code>: 寄存器和 BPF 上下文。</li>
<li><code>struct sock *sk</code>: tcp_v4_connect() 的第一个参数。</li>
</ul>
<p>第一个参数始终是 <code>struct pt_regs *</code>，其余的是函数的参数（如果你不打算使用它们，则不需要指定）。</p>
<p>示例代码：
<a href="https://github.com/iovisor/bcc/blob/4afa96a71c5dbfc4c507c3355e20baa6c184a3a8/examples/tracing/tcpv4connect.py#L28">code</a>（<a href="https://github.com/iovisor/bcc/blob/5bd0eb21fd148927b078deb8ac29fff2fb044b66/examples/tracing/tcpv4connect_example.txt#L8">输出结果</a>),"."<a href="https://github.com/iovisor/bcc/commit/310ab53710cfd46095c1f6b3e44f1dbc8d1a41d8#diff-8cd1822359ffee26e7469f991ce0ef00R26">code</a> （<a href="https://github.com/iovisor/bcc/blob/3b9679a3bd9b922c736f6061dc65cb56de7e0250/examples/tracing/bitehist_example.txt#L6">output</a>)</p>
<!--- 这里无法添加搜索链接，因为GitHub目前无法处理"kprobe__"所需的部分词搜索--->

<h3 id="2-kretprobes">2. kretprobes</h3>
<p>语法: kretprobe__<em>kernel_function_name</em></p>
<p><code>kretprobe__</code>是一个特殊的前缀，它创建了一个kretprobe（对提供的内核函数名进行动态追踪，跟踪内核函数的返回）。您也可以通过声明一个普通的C函数，然后使用Python的<code>BPF.attach_kretprobe()</code>（稍后介绍）将其与内核函数关联起来，来使用kretprobes。</p>
<p>返回值可用作<code>PT_REGS_RC(ctx)</code>，给定函数声明为：kretprobe__<em>kernel_function_name</em>(struct pt_regs *ctx)</p>
<p>例如:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">kretprobe__tcp_v4_connect</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">pt_regs</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">)</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="p">{</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PT_REGS_RC</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="p">[...]</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="p">}</span>
</code></pre></div>
<p>这个例子使用kretprobe来对tcp_v4_connect()内核函数的返回进行检测，并将返回值存储在<code>ret</code>中。</p>
<p>现有的用法示例:
<a href="https://github.com/iovisor/bcc/blob/4afa96a71c5dbfc4c507c3355e20baa6c184a3a8/examples/tracing/tcpv4connect.py#L38">code</a> （<a href="https://github.com/iovisor/bcc/blob/5bd0eb21fd148927b078deb8ac29fff2fb044b66/examples/tracing/tcpv4connect_example.txt#L8">output</a>)</p>
<h3 id="3-tracepoints">3. Tracepoints</h3>
<p>语法: TRACEPOINT_PROBE(<em>category</em>, <em>event</em>)</p>
<p>这是一个宏，用于对由<em>category</em>:<em>event</em>定义的tracepoint进行追踪。</p>
<p>tracepoint名称为<code>&lt;category&gt;:&lt;event&gt;</code>。
probe函数名为<code>tracepoint__&lt;category&gt;__&lt;event&gt;</code>。</p>
<p>参数在一个<code>args</code>结构体中可用，这些参数是tracepoint的参数。列出这些参数的一种方法是在/sys/kernel/debug/tracing/events/<em>category</em>/<em>event</em>/format下查看相关的格式文件。"<code>args</code> 结构体可用于替代 <code>ctx</code>，作为需要上下文作为参数的每个函数中的参数。这包括特别是 <a href="#3-perf_submit">perf_submit()</a>。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">TRACEPOINT_PROBE</span><span class="p">(</span><span class="n">random</span><span class="p">,</span><span class="w"> </span><span class="n">urandom_read</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="c1">// args is from /sys/kernel/debug/tracing/events/random/urandom_read/format</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="n">bpf_trace_printk</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="o">-&gt;</span><span class="n">got_bits</span><span class="p">);</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="p">}</span>
</code></pre></div>
<p>这会给 <code>random:urandom_read</code> 追踪点注入代码，并打印出追踪点参数 <code>got_bits</code>。
在使用 Python API 时，此探针会自动附加到正确的追踪点目标上。
对于 C++，可以通过明确指定追踪点目标和函数名来附加此追踪点探针：
<code>BPF::attach_tracepoint("random:urandom_read", "tracepoint__random__urandom_read")</code>
注意，上面定义的探针函数的名称是 <code>tracepoint__random__urandom_read</code>。</p>
<p>实际示例：
<a href="https://github.com/iovisor/bcc/blob/a4159da8c4ea8a05a3c6e402451f530d6e5a8b41/examples/tracing/urandomread.py#L19">code</a> (<a href="https://github.com/iovisor/bcc/commit/e422f5e50ecefb96579b6391a2ada7f6367b83c4#diff-41e5ecfae4a3b38de5f4e0887ed160e5R10">output</a>)，
<a href="https://github.com/iovisor/bcc/tree/master/examples">search /examples</a>，
<a href="https://github.com/iovisor/bcc/tree/master/tools">search /tools</a></p>
<h3 id="4-uprobes">4. uprobes</h3>
<p>这些是通过在 C 中声明一个普通函数，然后在 Python 中通过 <code>BPF.attach_uprobe()</code> 将其关联为 uprobes 探针来进行注入的（稍后会介绍）。</p>
<p>可以使用 <code>PT_REGS_PARM</code> 宏来检查参数。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">pt_regs</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="n">bpf_probe_read_user</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">PT_REGS_PARM1</span><span class="p">(</span><span class="n">ctx</span><span class="p">));</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="n">bpf_trace_printk</span><span class="p">(</span><span class="s">&quot;%s %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">PT_REGS_PARM2</span><span class="p">(</span><span class="n">ctx</span><span class="p">));</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="p">}</span>
</code></pre></div>
<p>这将读取第一个参数作为字符串，然后用第二个参数作为整数打印出来。</p>
<p>实际示例：
<a href="https://github.com/iovisor/bcc/blob/4afa96a71c5dbfc4c507c3355e20baa6c184a3a8/examples/tracing/strlen_count.py#L26">code</a>。### 5。uretprobes</p>
<p>这些是通过在C中声明一个普通函数，然后在Python中通过<code>BPF.attach_uretprobe()</code>将其关联为uretprobe探测点（稍后详述）来进行插装的。</p>
<p>返回值可以通过<code>PT_REGS_RC(ctx)</code>访问，前提是有一个如下声明的函数：<em>function_name</em>(struct pt_regs *ctx)</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">BPF_HISTOGRAM</span><span class="p">(</span><span class="n">dist</span><span class="p">);</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kt">int</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">pt_regs</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="n">dist</span><span class="p">.</span><span class="n">increment</span><span class="p">(</span><span class="n">PT_REGS_RC</span><span class="p">(</span><span class="n">ctx</span><span class="p">));</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="p">}</span>
</code></pre></div>
<p>这会递增由返回值索引的<code>dist</code>直方图中的存储桶。</p>
<p>现场演示示例：
<a href="https://github.com/iovisor/bcc/blob/4afa96a71c5dbfc4c507c3355e20baa6c184a3a8/examples/tracing/strlen_hist.py#L39">code</a> (<a href="https://github.com/iovisor/bcc/blob/4afa96a71c5dbfc4c507c3355e20baa6c184a3a8/examples/tracing/strlen_hist.py#L15">output</a>),
<a href="https://github.com/iovisor/bcc/blob/4afa96a71c5dbfc4c507c3355e20baa6c184a3a8/tools/bashreadline.py">code</a> (<a href="https://github.com/iovisor/bcc/commit/aa87997d21e5c1a6a20e2c96dd25eb92adc8e85d#diff-2fd162f9e594206f789246ce97d62cf0R7">output</a>)</p>
<h3 id="6-usdt">6. USDT探测点</h3>
<p>这些是用户静态定义追踪（USDT）探测点，可以放置在某些应用程序或库中，以提供用户级别等效的跟踪点。用于USDT支持的主要BPF方法是<code>enable_probe()</code>。通过在C中声明一个普通函数，然后在Python中通过<code>USDT.enable_probe()</code>将其关联为USDT探测点来进行插装。</p>
<p>可以通过以下方式读取参数：bpf_usdt_readarg(<em>index</em>, ctx, &amp;addr)</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">do_trace</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">pt_regs</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">addr</span><span class="p">;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">path</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="n">bpf_usdt_readarg</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">addr</span><span class="p">);</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="n">bpf_probe_read_user</span><span class="p">(</span><span class="o">&amp;</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">addr</span><span class="p">);</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="n">bpf_trace_printk</span><span class="p">(</span><span class="s">&quot;path:%s</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="p">};</span>
</code></pre></div>
<p>这会读取第六个USDT参数，然后将其作为字符串存储到<code>path</code>中。当使用C API中的<code>BPF::init</code>的第三个参数进行USDT的初始化时，如果任何USDT无法进行<code>init</code>，则整个<code>BPF::init</code>都会失败。如果您对一些USDT无法进行<code>init</code>感到满意，则在调用<code>BPF::init</code>之前使用<code>BPF::init_usdt</code>。</p>
<h3 id="7">7. 原始跟踪点</h3>
<p>语法：RAW_TRACEPOINT_PROBE(<em>event</em>)</p>
<p>这是一个宏，用于仪表化由<em>event</em>定义的原始跟踪点。</p>
<p>该参数是指向结构体<code>bpf_raw_tracepoint_args</code>的指针，该结构体定义在<a href="https://github.com/iovisor/bcc/blob/master/src/cc/compat/linux/virtual_bpf.h">bpf.h</a>中。结构体字段<code>args</code>包含了原始跟踪点的所有参数，可以在<a href="https://github.com/torvalds/linux/tree/master/include/trace/events">include/trace/events</a>目录中找到。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">RAW_TRACEPOINT_PROBE</span><span class="p">(</span><span class="n">sched_switch</span><span class="p">)</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="p">{</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="c1">// TP_PROTO(bool preempt, struct task_struct *prev, struct task_struct *next)</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">task_struct</span><span class="w"> </span><span class="o">*</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">task_struct</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">ctx</span><span class="o">-&gt;</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">task_struct</span><span class="w"> </span><span class="o">*</span><span class="n">next</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">task_struct</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">ctx</span><span class="o">-&gt;</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="n">s32</span><span class="w"> </span><span class="n">prev_tgid</span><span class="p">,</span><span class="w"> </span><span class="n">next_tgid</span><span class="p">;</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="n">bpf_probe_read_kernel</span><span class="p">(</span><span class="o">&amp;</span><span class="n">prev_tgid</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">tgid</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">tgid</span><span class="p">);</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="n">bpf_probe_read_kernel</span><span class="p">(</span><span class="o">&amp;</span><span class="n">next_tgid</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">tgid</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">tgid</span><span class="p">);</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="n">bpf_trace_printk</span><span class="p">(</span><span class="s">&quot;%d -&gt; %d</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">prev_tgid</span><span class="p">,</span><span class="w"> </span><span class="n">next_tgid</span><span class="p">);</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="p">}</span>
</code></pre></div>
<p>这将仪表化sched:sched_switch跟踪点，并打印prev和next tgid。</p>
<h3 id="8">8. 系统调用跟踪点</h3>
<p>语法：<code>syscall__SYSCALLNAME</code>。<code>syscall__</code>是一个特殊的前缀，用于为提供的系统调用名称创建一个kprobe。您可以通过声明一个普通的C函数，然后使用Python的<code>BPF.get_syscall_fnname(SYSCALLNAME)</code>和<code>BPF.attach_kprobe()</code>来使用它。</p>
<p>参数在函数声明中指定: <code>syscall__SYSCALLNAME(struct pt_regs *ctx, [, argument1 ...])</code>.</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">syscall__execve</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">pt_regs</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">,</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">__user</span><span class="w"> </span><span class="o">*</span><span class="n">filename</span><span class="p">,</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">__user</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">__user</span><span class="w"> </span><span class="o">*</span><span class="n">__argv</span><span class="p">,</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">__user</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">__user</span><span class="w"> </span><span class="o">*</span><span class="n">__envp</span><span class="p">)</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="p">{</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">    </span><span class="p">[...]</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="p">}</span>
</code></pre></div>
<p>这将对execve系统调用进行探查。</p>
<p>第一个参数始终是<code>struct pt_regs *</code>，其余的参数是函数的参数（如果您不打算使用它们，则无需指定）。</p>
<p>相应的Python代码：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">b</span> <span class="o">=</span> <span class="n">BPF</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">bpf_text</span><span class="p">)</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">execve_fnname</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_syscall_fnname</span><span class="p">(</span><span class="s2">&quot;execve&quot;</span><span class="p">)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_kprobe</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">execve_fnname</span><span class="p">,</span> <span class="n">fn_name</span><span class="o">=</span><span class="s2">&quot;syscall__execve&quot;</span><span class="p">)</span>
</code></pre></div>
<p>示例：
<a href="https://github.com/iovisor/bcc/blob/552658edda09298afdccc8a4b5e17311a2d8a771/tools/execsnoop.py#L101">code</a> (<a href="https://github.com/iovisor/bcc/blob/552658edda09298afdccc8a4b5e17311a2d8a771/tools/execsnoop_example.txt#L8">output</a>)</p>
<h3 id="9-kfuncs">9. kfuncs</h3>
<p>语法：KFUNC_PROBE(<em>function</em>, typeof(arg1) arg1, typeof(arg2) arge ...)</p>
<p>这是一个通过跳板来在内核函数执行<strong>之前</strong>对其进行探查的宏。它由<em>function</em>名称和<em>argX</em>定义的函数参数组成。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">KFUNC_PROBE</span><span class="p">(</span><span class="n">do_sys_open</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">dfd</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mode</span><span class="p">)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="p">{</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="p">}</span>
</code></pre></div>
<p>这将对do_sys_open内核函数进行探查，并将其参数作为标准参数值访问。</p>
<p>示例：
<a href="https://github.com/iovisor/bcc/tree/master/tools">search /tools</a></p>
<h3 id="10-kretfuncs">10. kretfuncs</h3>
<p>语法：KRETFUNC_PROBE(<em>event</em>, typeof(arg1) arg1, typeof(arg2) arge ..., int ret)</p>
<p>这是一个通过跳板来在内核函数执行<strong>之前</strong>探查的宏。
格式：仅返回翻译后的内容，不包括原始文本。<em>在</em>函数执行之后。它由<em>函数</em>名称和定义为<em>argX</em>的函数参数定义。</p>
<p>探针的最后一个参数是检测函数的返回值。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">KRETFUNC_PROBE</span><span class="p">(</span><span class="n">do_sys_open</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">dfd</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="p">)</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="p">{</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="p">...</span>
</code></pre></div>
<p>这会对do_sys_open内核函数进行检测，并将其参数作为标准参数值一起与其返回值一起提取。</p>
<p>原地示例：
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /tools</a></p>
<h3 id="11-lsm-probes">11. LSM Probes</h3>
<p>语法：LSM_PROBE(<em>hook</em>, typeof(arg1) arg1, typeof(arg2) arg2 ...)</p>
<p>这是一种将LSM挂钩作为BPF程序进行检测的宏。它可以用于审计安全事件和实施BPF中的MAC安全策略。
它通过指定挂钩名及其参数来定义。</p>
<p>可以在
<a href="https://github.com/torvalds/linux/blob/v5.15/include/linux/security.h#L260">include/linux/security.h</a>
中找到挂钩名称，方法是取security_hookname之类的函数名，然后只保留<code>hookname</code>部分。
例如，<code>security_bpf</code>仅变成了<code>bpf</code>。</p>
<p>与其他BPF程序类型不同，LSM探针中指定的返回值是很重要的。返回值为0表示挂钩成功，而
任何非零的返回值都会导致挂钩失败和拒绝安全操作。</p>
<p>以下示例对一个拒绝所有未来BPF操作的挂钩进行了检测：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">LSM_PROBE</span><span class="p">(</span><span class="n">bpf</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">cmd</span><span class="p">,</span><span class="w"> </span><span class="k">union</span><span class="w"> </span><span class="nc">bpf_attr</span><span class="w"> </span><span class="o">*</span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="p">{</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="n">EPERM</span><span class="p">;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="p">}</span>
</code></pre></div>
<p>这会对<code>security_bpf</code>挂钩进行检测，并导致其返回<code>-EPERM</code>。
将<code>return -EPERM</code>更改为<code>return 0</code>会导致BPF程序允许该操作。</p>
<p>LSM探针需要至少一个5.7+内核，并设置了以下配置选项：</p>
<ul>
<li><code>CONFIG_BPF_LSM=y</code></li>
<li><code>CONFIG_LSM</code> 逗号分隔的字符串必须包含"bpf"（例如，
  <code>CONFIG_LSM="lockdown,yama,bpf"</code>)</li>
</ul>
<p>原地示例："<a href="https://github.com/iovisor/bcc/tree/master/tests">搜索/tests</a></p>
<h3 id="12-bpf">12. BPF迭代器</h3>
<p>语法: BPF_ITER(target)</p>
<p>这是一个宏，用于定义一个bpf迭代器程序的程序签名。参数 <em>target</em> 指定要迭代的内容。</p>
<p>目前，内核没有接口来发现支持哪些目标。一个好的查找支持内容的地方是在 <a href="https://github.com/torvalds/linux/blob/master/tools/testing/selftests/bpf/prog_tests/bpf_iter.c">tools/testing/selftests/bpf/prog_test/bpf_iter.c</a> ，一些示例bpf迭代器程序位于 <a href="https://github.com/torvalds/linux/tree/master/tools/testing/selftests/bpf/progs">tools/testing/selftests/bpf/progs</a> ，其中文件名以 <em>bpf_iter</em> 为前缀。</p>
<p>以下示例为 <em>task</em> 目标定义了一个程序，该程序遍历内核中的所有任务。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">BPF_ITER</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="p">{</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">seq_file</span><span class="w"> </span><span class="o">*</span><span class="n">seq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="o">-&gt;</span><span class="n">meta</span><span class="o">-&gt;</span><span class="n">seq</span><span class="p">;</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">task_struct</span><span class="w"> </span><span class="o">*</span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="o">-&gt;</span><span class="n">task</span><span class="p">;</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">task</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">  </span><span class="p">...</span><span class="w"> </span><span class="n">task</span><span class="o">-&gt;</span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="n">task</span><span class="o">-&gt;</span><span class="n">tgid</span><span class="p">,</span><span class="w"> </span><span class="n">task</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="p">...</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="p">}</span>
</code></pre></div>
<p>在5.8内核中引入了BPF迭代器，可以用于任务（task）、任务文件（task_file）、bpf map、netlink_sock和ipv6_route。在5.9中，对tcp/udp socket和bpf map元素（hashmap、arraymap和sk_local_storage_map）遍历添加了支持。</p>
<h2 id="_2">数据</h2>
<h3 id="1-bpf_probe_read_kernel">1. bpf_probe_read_kernel()</h3>
<p>语法: <code>int bpf_probe_read_kernel(void *dst, int size, const void*src)</code></p>
<p>返回值: 成功时返回0</p>
<p>该函数将从内核地址空间复制size字节到BPF堆栈，以便BPF之后可以对其进行操作。为了安全起见，所有内核内存读取都必须通过bpf_probe_read_kernel()进行。在某些情况下，比如解引用内核变量时，这会自动发生，因为bcc会重新编写BPF程序以包含所需的bpf_probe_read_kernel()。</p>
<p>现场示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /tools</a></p>
<h3 id="2-bpf_probe_read_kernel_strshell">2. bpf_probe_read_kernel_str()".```shell</h3>
<p>语法：<code>int bpf_probe_read_kernel_str(void *dst, int size, const void*src)</code></p>
<p>返回值：</p>
<ul>
<li>&gt; 0 成功时字符串长度（包括结尾的NULL字符）</li>
<li>\&lt; 0 出错</li>
</ul>
<p>该函数将一个以<code>NULL</code>结尾的字符串从内核地址空间复制到BPF堆栈中，以便BPF以后可以对其进行操作。如果字符串的长度小于size，则目标不会用更多的<code>NULL</code>字节进行填充。如果字符串的长度大于size，则只会复制<code>size - 1</code>个字节，并将最后一个字节设置为<code>NULL</code>。</p>
<p>示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="3-bpf_ktime_get_ns">3. bpf_ktime_get_ns()</h3>
<p>语法：<code>u64 bpf_ktime_get_ns(void)</code></p>
<p>返回值：u64 纳秒数。从系统启动时间开始计数，但在挂起期间停止计数。</p>
<p>示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="4-bpf_get_current_pid_tgid">4. bpf_get_current_pid_tgid()</h3>
<p>语法：<code>u64 bpf_get_current_pid_tgid(void)</code></p>
<p>返回值：<code>current-&gt;tgid &lt;&lt; 32 | current-&gt;pid</code></p>
<p>返回进程ID位于低32位（内核视图的PID，在用户空间通常表示为线程ID），线程组ID位于高32位（在用户空间通常被认为是PID）。通过直接设置为u32类型，我们丢弃了高32位。</p>
<p>示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="5-bpf_get_current_uid_gid">5. bpf_get_current_uid_gid()</h3>
<p>语法：<code>u64 bpf_get_current_uid_gid(void)</code></p>
<p>返回值：<code>current_gid &lt;&lt; 32 | current_uid</code></p>
<p>返回用户ID和组ID。</p>
<p>示例：<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>, <a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="6-bpf_get_current_comm">6. bpf_get_current_comm()</h3>
<p>语法: <code>bpf_get_current_comm(char *buf, int size_of_buf)</code></p>
<p>返回值: 成功时返回0</p>
<p>将当前进程的名称填充到第一个参数地址中。它应该是一个指向字符数组的指针，大小至少为TASK_COMM_LEN，该变量在linux/sched.h中定义。例如:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/sched.h&gt;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">do_trace</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">pt_regs</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">comm</span><span class="p">[</span><span class="n">TASK_COMM_LEN</span><span class="p">];</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span><span class="n">bpf_get_current_comm</span><span class="p">(</span><span class="o">&amp;</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">comm</span><span class="p">));</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="p">[...]</span>
</code></pre></div>
<p>现有示例:
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>, <a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="7-bpf_get_current_task">7. bpf_get_current_task()</h3>
<p>语法: <code>bpf_get_current_task()</code></p>
<p>返回值: 返回指向当前任务的struct task_struct指针。</p>
<p>返回指向当前任务的task_struct对象的指针。该辅助函数可用于计算进程的CPU时间，标识内核线程，获取当前CPU的运行队列或检索许多其他信息。</p>
<p>在Linux 4.13中，由于字段随机化的问题，您可能需要在包含之前定义两个#define指令:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="cp">#define randomized_struct_fields_start  struct {</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="cp">#define randomized_struct_fields_end    };</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;linux/sched.h&gt;</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">do_trace</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">task_struct</span><span class="w"> </span><span class="o">*</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">task_struct</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">bpf_get_current_task</span><span class="p">();</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="p">[...]</span>
</code></pre></div>
<p>现有示例:
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>, <a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="8-bpf_log2l">8. bpf_log2l()</h3>
<p>语法: <code>unsigned int bpf_log2l(unsigned long v)</code></p>
<p>返回提供的值的log-2。这通常用于创建直方图的索引，以构建2的幂次直方图。在原地示例：</p>
<p><a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/示例</a>，
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/工具</a></p>
<h3 id="9-bpf_get_prandom_u32">9. bpf_get_prandom_u32()</h3>
<p>语法：<code>u32 bpf_get_prandom_u32()</code></p>
<p>返回一个伪随机的 u32。</p>
<p>在原地示例：</p>
<p><a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/示例</a>，
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/工具</a></p>
<h3 id="10-bpf_probe_read_user">10. bpf_probe_read_user()</h3>
<p>语法：<code>int bpf_probe_read_user(void *dst, int size, const void*src)</code></p>
<p>返回值：成功时返回0</p>
<p>该函数尝试安全地从用户地址空间读取size个字节到BPF栈中，以便BPF之后可以操作它。为确保安全，所有用户地址空间内存读取必须通过bpf_probe_read_user()。</p>
<p>在原地示例：</p>
<p><a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/示例</a>，
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/工具</a></p>
<h3 id="11-bpf_probe_read_user_str">11. bpf_probe_read_user_str()</h3>
<p>语法：<code>int bpf_probe_read_user_str(void *dst, int size, const void*src)</code></p>
<p>返回值：</p>
<ul>
<li>&gt; 0 成功时返回字符串长度（包括结尾的NULL）</li>
<li>\&lt; 0 错误</li>
</ul>
<p>该函数将一个以<code>NULL</code>结尾的字符串从用户地址空间复制到BPF栈中，以便BPF之后可以操作它。如果字符串长度小于size，则目标不会用额外的<code>NULL</code>字节填充。如果字符串长度大于size，则只会复制<code>size - 1</code>字节，并将最后一字节设置为<code>NULL</code>。</p>
<p>在原地示例：</p>
<p><a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/示例</a>，
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/工具</a></p>
<h3 id="12-bpf_get_ns_current_pid_tgid">12. bpf_get_ns_current_pid_tgid()</h3>
<p>语法：<code>u32 bpf_get_ns_current_pid_tgid(u64 dev, u64 ino, struct bpf_pidns_info*nsdata, u32 size)</code>。从当前<strong>命名空间</strong>中看到的<em>pid</em>和<em>tgid</em>的值将在<em>nsdata</em>中返回。</p>
<p>成功返回0，失败时返回以下之一：</p>
<ul>
<li>
<p>如果提供的dev和inum与当前任务的nsfs的dev_t和inode号不匹配，或者dev转换为dev_t丢失了高位，则返回<strong>-EINVAL</strong>。</p>
</li>
<li>
<p>如果当前任务的pidns不存在，则返回<strong>-ENOENT</strong>。</p>
</li>
</ul>
<p>原地示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h2 id="_3">调试</h2>
<h3 id="1-bpf_override_return">1. bpf_override_return()</h3>
<p>语法：<code>int bpf_override_return(struct pt_regs *, unsigned long rc)</code></p>
<p>返回值：成功时返回0</p>
<p>当用于附加到函数入口的程序时，会导致该函数的执行被跳过，立即返回<code>rc</code>。这用于目标错误注入。</p>
<p>仅当允许错误注入时，bpf_override_return才有效。白名单列表中需要在内核源代码中给一个函数打上 <code>ALLOW_ERROR_INJECTION()</code> 的标签；参考 <code>io_ctl_init</code> 的示例。如果该函数未被加入白名单，bpf程序将无法附加，出现 <code>ioctl(PERF_EVENT_IOC_SET_BPF): Invalid argument</code> 错误。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">kprobe__io_ctl_init</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w"> </span><span class="n">bpf_override_return</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">ENOMEM</span><span class="p">);</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="p">}</span>
</code></pre></div>
<h2 id="_4">输出</h2>
<h3 id="1-bpf_trace_printk">1. bpf_trace_printk()</h3>
<p>语法：<code>int bpf_trace_printk(const char *fmt, ...)</code></p>
<p>返回值：成功时返回0</p>
<p>对于通常的trace_pipe (/sys/kernel/debug/tracing/trace_pipe)提供了一个简单的内核printf()功能。这对于一些快速示例是可以接受的，但有一些限制：最多3个参数，只有一个%s，而且trace_pipe是全局共享的，所以并发程序会有冲突输出。更好的接口是通过BPF_PERF_OUTPUT()。注意，与原始内核版本相比，调用这个辅助函数变得更简单，它的第二个参数已经是 <code>fmt_size</code>。</p>
<p>原地示例："<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /示例</a>, <a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /工具</a></p>
<h3 id="2-bpf_perf_output">2. BPF_PERF_OUTPUT</h3>
<p>语法：<code>BPF_PERF_OUTPUT(name)</code></p>
<p>创建一个BPF表格，通过性能环形缓冲区将自定义事件数据推送到用户空间。这是将每个事件数据推送到用户空间的首选方法。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">data_t</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="n">u32</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="n">u64</span><span class="w"> </span><span class="n">ts</span><span class="p">;</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">comm</span><span class="p">[</span><span class="n">TASK_COMM_LEN</span><span class="p">];</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="p">};</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="n">BPF_PERF_OUTPUT</span><span class="p">(</span><span class="n">events</span><span class="p">);</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">pt_regs</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">data_t</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">    </span><span class="n">data</span><span class="p">.</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bpf_get_current_pid_tgid</span><span class="p">();</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">    </span><span class="n">data</span><span class="p">.</span><span class="n">ts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bpf_ktime_get_ns</span><span class="p">();</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">    </span><span class="n">bpf_get_current_comm</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">.</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">comm</span><span class="p">));</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="w">    </span><span class="n">events</span><span class="p">.</span><span class="n">perf_submit</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">data</span><span class="p">));</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="p">}</span>
</code></pre></div>
<p>输出表格名为<code>events</code>，数据通过<code>events.perf_submit()</code>推送到该表格。</p>
<p>示例中包含以下内容：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /示例</a>, <a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /工具</a></p>
<h3 id="3-perf_submit">3. perf_submit()</h3>
<p>语法：<code>int perf_submit((void *)ctx, (void*)data, u32 data_size)</code></p>
<p>返回值：成功返回0</p>
<p>这是BPF_PERF_OUTPUT表格的一种方法，用于向用户空间提交自定义事件数据。参见BPF_PERF_OUTPUT条目（最终调用bpf_perf_event_output()）。</p>
<p><code>ctx</code>参数在<a href="#1-kprobes">kprobes</a>或<a href="#2-kretprobes">kretprobes</a>中提供。对于<code>SCHED_CLS</code>或<code>SOCKET_FILTER</code>程序，必须使用<code>struct __sk_buff *skb</code>。</p>
<p>示例中包含以下内容：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /示例</a>, <a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /工具</a></p>
<h3 id="4-perf_submit_skb">4. perf_submit_skb()</h3>
<p>语法：<code>int perf_submit_skb((void *)ctx, u32 packet_size, (void*)data, u32 data_size)</code></p>
<p>返回值：成功返回0".一种在网络程序类型中可用的BPF_PERF_OUTPUT表的方法，用于将自定义事件数据和数据包缓冲区的前<code>packet_size</code>字节一起提交到用户空间。请参阅BPF_PERF_OUTPUT条目。（最终调用bpf_perf_event_output()函数。）</p>
<p>现场示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="5-bpf_ringbuf_output">5. BPF_RINGBUF_OUTPUT</h3>
<p>语法：<code>BPF_RINGBUF_OUTPUT(name, page_cnt)</code></p>
<p>创建一个BPF表，通过一个环形缓冲区将自定义事件数据推送到用户空间。
<code>BPF_RINGBUF_OUTPUT</code>相较于<code>BPF_PERF_OUTPUT</code>具有以下几个优点：</p>
<ul>
<li>缓冲区在所有CPU之间共享，即每个CPU不需要单独分配</li>
<li>支持两种BPF程序的API</li>
<li><code>map.ringbuf_output()</code>类似于<code>map.perf_submit()</code>（在<a href="#6-ringbuf_output">ringbuf_output</a>中介绍）</li>
<li><code>map.ringbuf_reserve()</code>/<code>map.ringbuf_submit()</code>/<code>map.ringbuf_discard()</code>将保留缓冲区空间和提交事件的过程分为两步（在<a href="#7-ringbuf_reserve">ringbuf_reserve</a>、<a href="#8-ringbuf_submit">ringbuf_submit</a>和<a href="#9-ringbuf_discard">ringbuf_discard</a>中介绍）</li>
<li>BPF API不需要访问CPU ctx参数</li>
<li>通过共享的环形缓冲区管理器，在用户空间中具有更高的性能和更低的延迟</li>
<li>支持两种在用户空间中消费数据的方式</li>
</ul>
<p>从Linux 5.8开始，这应该是将事件数据推送到用户空间的首选方法。</p>
<p>输出表命名为'事件'。数据通过'事件'。ringbuf_reserve（）分配，并通过'事件'。ringbuf_submit（）推送到其中。</p>
<p>在situ示例：<!-- TODO -->
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/示例</a>，</p>
<h3 id="6-ringbuf_output">6. ringbuf_output（）</h3>
<p>语法：int ringbuf_output（（void *）data，u64 data_size，u64 flags）</p>
<p>返回：成功返回0</p>
<p>标志：</p>
<ul>
<li><code>BPF_RB_NO_WAKEUP</code>：不发送新数据可用的通知</li>
<li><code>BPF_RB_FORCE_WAKEUP</code>：无条件发送新数据可用的通知</li>
</ul>
<p>BPF_RINGBUF_OUTPUT表的方法，用于将自定义事件数据提交给用户空间。此方法类似于<code>perf_submit（）</code>，但不需要ctx参数。</p>
<p>在situ示例：<!-- TODO -->
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/示例</a>，</p>
<h3 id="7-ringbuf_reserve">7. ringbuf_reserve()</h3>
<p>语法：void * ringbuf_reserve（u64 data_size）</p>
<p>返回：成功时返回数据结构的指针，失败时返回NULL</p>
<p>BPF_RINGBUF_OUTPUT表的方法，用于在环形缓冲区中保留空间并同时分配一个用于输出的数据结构。必须与<code>ringbuf_submit</code>或<code>ringbuf_discard</code>之一配合使用。</p>
<p>在situ示例：<!-- TODO -->
[搜索/示例]（&lt;https://github.com/iovisor/bcc/tree/master/examples)```之前调用，以为数据预留空间。</p>
<p>现场示例：<!-- TODO -->
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,</p>
<h3 id="9-ringbuf_discard">9. ringbuf_discard()</h3>
<p>语法: <code>void ringbuf_discard((void *)data, u64 flags)</code></p>
<p>返回值: 无，始终成功</p>
<p>标志:</p>
<ul>
<li><code>BPF_RB_NO_WAKEUP</code>: 不发送新数据可用的通知</li>
<li><code>BPF_RB_FORCE_WAKEUP</code>: 无条件发送新数据可用的通知</li>
</ul>
<p>BPF_RINGBUF_OUTPUT表的方法，用于丢弃自定义事件数据；用户空间将忽略与丢弃事件相关联的数据。必须在调用<code>ringbuf_reserve()</code>之前调用，以为数据预留空间。</p>
<p>现场示例：<!-- TODO -->
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,</p>
<h2 id="maps">Maps</h2>
<p>Maps是BPF数据存储，是更高级对象类型（包括表、哈希和直方图）的基础。</p>
<h3 id="1-bpf_table">1. BPF_TABLE</h3>
<p>语法: <code>BPF_TABLE(_table_type,_key_type, _leaf_type,_name, _max_entries)</code></p>
<p>创建名为<code>_name</code>的映射。大多数情况下，这将通过更高级的宏（如BPF_HASH、BPF_ARRAY、BPF_HISTOGRAM等）使用。</p>
<p><code>BPF_F_TABLE</code>是一个变体，最后一个参数采用标志。<code>BPF_TABLE(https://github.com/iovisor/bcc/tree/master.)</code>实际上是`BPF_F_TABLE(<a href="https://github.com/iovisor/bcc/tree/master">https://github.com/iovisor/bcc/tree/master</a>., 0 /<em>flag</em>/)```的包装。</p>
<p>方法（稍后讨论）：map.lookup()、map.lookup_or_try_init()、map.delete()、map.update()、map.insert()、map.increment()。</p>
<p>现场示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,"<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /工具</a></p>
<h4 id="_5">固定映射</h4>
<p>语法: <code>BPF_TABLE_PINNED(_table_type,_key_type, _leaf_type,_name, _max_entries, "/sys/fs/bpf/xyz")</code></p>
<p>如果映射不存在，则创建一个新的映射并将其固定到bpffs作为文件；否则使用已固定到bpffs的映射。类型信息不强制执行，实际的映射类型取决于固定到位置的映射。</p>
<p>例如:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">BPF_TABLE_PINNED</span><span class="p">(</span><span class="s">&quot;hash&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">u64</span><span class="p">,</span><span class="w"> </span><span class="n">u64</span><span class="p">,</span><span class="w"> </span><span class="n">ids</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/sys/fs/bpf/ids&quot;</span><span class="p">);</span>
</code></pre></div>
<h3 id="2-bpf_hash">2. BPF_HASH</h3>
<p>语法: <code>BPF_HASH(name [, key_type [, leaf_type [, size]]])</code></p>
<p>创建一个哈希映射（关联数组），名称为<code>name</code>，具有可选参数。</p>
<p>默认值: <code>BPF_HASH(name, key_type=u64, leaf_type=u64, size=10240)</code></p>
<p>例如:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">BPF_HASH</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">request</span><span class="w"> </span><span class="o">*</span><span class="p">);</span>
</code></pre></div>
<p>这将创建一个名为<code>start</code>的哈希，其中关键字为<code>struct request *</code>，值默认为u64。此哈希由disksnoop.py示例用于保存每个I/O请求的时间戳，其中关键字是指向struct request的指针，而值是时间戳。</p>
<p>这是<code>BPF_TABLE("hash", ...)</code>的包装宏。</p>
<p>方法（稍后涵盖）：map.lookup()，map.lookup_or_try_init()，map.delete()，map.update()，map.insert()，map.increment()。</p>
<p>示例中的原位置链接：<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /示例</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /工具</a></p>
<h3 id="3-bpf_array">3. BPF_ARRAY</h3>
<p>语法: <code>BPF_ARRAY(name [, leaf_type [, size]])</code></p>
<p>创建一个以整数索引的数组，最快速的查找和更新为优化，名称为<code>name</code>，具有可选参数。</p>
<p>默认值: <code>BPF_ARRAY(name, leaf_type=u64, size=10240)</code></p>
<p>例如:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">BPF_ARRAY</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span><span class="w"> </span><span class="n">u64</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
</code></pre></div>
<p>这将创建一个名为<code>counts</code>的数组，其中有32个存储桶和64位整数值。funccount.py示例使用此数组保存每个函数的调用计数。".这是一个 <code>BPF_TABLE("array", ...)</code> 的包装宏。</p>
<p>方法（稍后介绍）：map.lookup()、map.update()、map.increment()。注意，所有数组元素都预先分配为零值，无法删除。</p>
<p>在当前位置的示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>，
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="4-bpf_histogram">4. BPF_HISTOGRAM</h3>
<p>语法：<code>BPF_HISTOGRAM(name [, key_type [, size ]])</code></p>
<p>创建一个名为 <code>name</code> 的直方图映射，包含可选参数。</p>
<p>默认值：<code>BPF_HISTOGRAM(name, key_type=int, size=64)</code></p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">BPF_HISTOGRAM</span><span class="p">(</span><span class="n">dist</span><span class="p">);</span>
</code></pre></div>
<p>这创建了一个名为 <code>dist</code> 的直方图，默认有 64 个桶，以 int 类型的键索引。</p>
<p>这是一个 <code>BPF_TABLE("histgram", ...)</code> 的包装宏。</p>
<p>方法（稍后介绍）：map.increment()。</p>
<p>在当前位置的示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>，
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="5-bpf_stack_trace">5. BPF_STACK_TRACE</h3>
<p>语法：<code>BPF_STACK_TRACE(name, max_entries)</code></p>
<p>创建一个名为 <code>name</code> 的堆栈跟踪映射，提供最大条目数。这些映射用于存储堆栈跟踪。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">BPF_STACK_TRACE</span><span class="p">(</span><span class="n">stack_traces</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">);</span>
</code></pre></div>
<p>这创建了一个名为 <code>stack_traces</code> 的堆栈跟踪映射，最大堆栈跟踪条目数为 1024。</p>
<p>这是一个 <code>BPF_TABLE("stacktrace", ...)</code> 的包装宏。</p>
<p>方法（稍后介绍）：map.get_stackid()。</p>
<p>在当前位置的示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>，
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="6-bpf_perf_array">6. BPF_PERF_ARRAY</h3>
<p>语法：<code>BPF_PERF_ARRAY(name, max_entries)</code></p>
<p>创建一个名为 <code>name</code> 的 perf 数组，提供最大条目数，该数必须等于系统 CPU 的数量。这些映射用于获取硬件性能计数器。例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">text</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">BPF_PERF_ARRAY</span><span class="p">(</span><span class="n">cpu_cycles</span><span class="p">,</span><span class="w"> </span><span class="n">NUM_CPUS</span><span class="p">);</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="s">&quot;&quot;&quot;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bcc</span><span class="p">.</span><span class="n">BPF</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">cflags</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;-DNUM_CPUS=%d&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">multiprocessing</span><span class="p">.</span><span class="n">cpu_count</span><span class="p">()])</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="n">b</span><span class="p">[</span><span class="s">&quot;cpu_cycles&quot;</span><span class="p">].</span><span class="n">open_perf_event</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="s">&quot;cpu_cycles&quot;</span><span class="p">].</span><span class="n">HW_CPU_CYCLES</span><span class="p">)</span>
</code></pre></div>
<p>这将创建一个名为<code>cpu_cycles</code>的性能数组，条目数量等于CPU核心数。该数组被配置为，稍后调用<code>map.perf_read()</code>将返回从过去某一时刻开始计算的硬件计数器的周期数。每个表只能配置一种类型的硬件计数器。</p>
<p>方法（稍后介绍）：<code>map.perf_read()</code>。</p>
<p>现场示例：
<a href="https://github.com/iovisor/bcc/tree/master/tests">搜索 /tests</a></p>
<h3 id="7-bpf_percpu_hash">7. BPF_PERCPU_HASH</h3>
<p>语法：<code>BPF_PERCPU_HASH(name [, key_type [, leaf_type [, size]]])</code></p>
<p>创建NUM_CPU个以int索引的哈希映射（关联数组），名为<code>name</code>，具有可选参数。每个CPU都会有一个单独的该数组副本。这些副本不以任何方式进行同步。</p>
<p>请注意，由于内核中定义的限制（位于linux/mm/percpu.c中），<code>leaf_type</code>的大小不能超过32KB。
换句话说，<code>BPF_PERCPU_HASH</code>元素的大小不能超过32KB。</p>
<p>默认值：<code>BPF_PERCPU_HASH(name, key_type=u64, leaf_type=u64, size=10240)</code></p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">BPF_PERCPU_HASH</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">request</span><span class="w"> </span><span class="o">*</span><span class="p">);</span>
</code></pre></div>
<p>这将创建名为<code>start</code>的NUM_CPU个哈希，其中键为<code>struct request *</code>，值默认为u64。</p>
<p>这是对<code>BPF_TABLE("percpu_hash", ...)</code>的包装宏。</p>
<p>方法（稍后介绍）：<code>map.lookup()</code>、<code>map.lookup_or_try_init()</code>、<code>map.delete()</code>、<code>map.update()</code>、<code>map.insert()</code>、<code>map.increment()</code>。</p>
<p>现场示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /tools</a></p>
<h3 id="8-bpf_percpu_array">8. BPF_PERCPU_ARRAY</h3>
<p>语法：<code>BPF_PERCPU_ARRAY(name [, leaf_type [, size]])</code>。创建<code>name</code>的NUM_CPU个按整数索引优化的数组，以实现最快的查找和更新，具有可选参数。每个CPU都会有一个单独的副本。这些副本不能以任何方式同步。</p>
<p>请注意，由于内核（在linux/mm/percpu.c中）定义的限制，<code>leaf_type</code>的大小不能超过32KB。
换句话说，<code>BPF_PERCPU_ARRAY</code>元素的大小不能超过32KB。</p>
<p>默认值：<code>BPF_PERCPU_ARRAY(name, leaf_type=u64, size=10240)</code></p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">BPF_PERCPU_ARRAY</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span><span class="w"> </span><span class="n">u64</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
</code></pre></div>
<p>这将创建NUM_CPU个名为<code>counts</code>的数组，其中每个数组有32个桶和64位整数值。</p>
<p>这是<code>BPF_TABLE("percpu_array", ...)</code>的包装宏。</p>
<p>方法（稍后介绍）：map.lookup()，map.update()，map.increment()。请注意，所有数组元素都预先分配为零值，并且不能被删除。</p>
<p>In situ示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>，
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="9-bpf_lpm_trie">9. BPF_LPM_TRIE</h3>
<p>语法：<code>BPF_LPM_TRIE(name [, key_type [, leaf_type [, size]]])</code></p>
<p>创建一个名为<code>name</code>的最长前缀匹配字典树映射，带有可选参数。</p>
<p>默认值：<code>BPF_LPM_TRIE(name, key_type=u64, leaf_type=u64, size=10240)</code></p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">BPF_LPM_TRIE</span><span class="p">(</span><span class="n">trie</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">key_v6</span><span class="p">);</span>
</code></pre></div>
<p>这将创建一个名为<code>trie</code>的LPM字典树映射，其中键是<code>struct key_v6</code>，值默认为u64。</p>
<p>这是一个对<code>BPF_F_TABLE("lpm_trie", ..., BPF_F_NO_PREALLOC)</code>的包装宏。</p>
<p>方法（稍后介绍）：map.lookup()，map.lookup_or_try_init()，map.delete()，map.update()，map.insert()，map.increment()。</p>
<p>In situ示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>，
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="10-bpf_prog_array">10. BPF_PROG_ARRAY</h3>
<p>语法：<code>BPF_PROG_ARRAY(name, size)</code>。创建一个名为 <code>name</code> 的程序数组，其中包含 <code>size</code> 个条目。数组的每个条目要么是指向一个 bpf 程序的文件描述符，要么是 <code>NULL</code>。该数组作为一个跳转表，以便 bpf 程序可以“尾调用”其他 bpf 程序。</p>
<p>这是一个 <code>BPF_TABLE("prog", ...)</code> 的包装宏。</p>
<p>方法（稍后介绍）：map.call()。</p>
<p>实时示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tests">搜索 /tests</a>,
<a href="https://github.com/iovisor/bcc/blob/master/examples/networking/tunnel_monitor/monitor.py#L24-L26">分配 fd</a></p>
<h3 id="11-bpf_devmap">11. BPF_DEVMAP</h3>
<p>语法：<code>BPF_DEVMAP(name, size)</code></p>
<p>这创建了一个名为 <code>name</code> 的设备映射，其中包含 <code>size</code> 个条目。映射的每个条目都是一个网络接口的 <code>ifindex</code>。此映射仅在 XDP 中使用。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">BPF_DEVMAP</span><span class="p">(</span><span class="n">devmap</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
</code></pre></div>
<p>方法（稍后介绍）：map.redirect_map()。</p>
<p>实时示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /examples</a>,</p>
<h3 id="12-bpf_cpumap">12. BPF_CPUMAP</h3>
<p>语法：<code>BPF_CPUMAP(name, size)</code></p>
<p>这创建了一个名为 <code>name</code> 的 CPU 映射，其中包含 <code>size</code> 个条目。映射的索引表示 CPU 的 ID，每个条目是为 CPU 分配的环形缓冲区的大小。此映射仅在 XDP 中使用。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">BPF_CPUMAP</span><span class="p">(</span><span class="n">cpumap</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span>
</code></pre></div>
<p>方法（稍后介绍）：map.redirect_map()。</p>
<p>实时示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /examples</a>,</p>
<h3 id="13-bpf_xskmap">13. BPF_XSKMAP</h3>
<p>语法：<code>BPF_XSKMAP(name, size [, "/sys/fs/bpf/xyz"])</code>。这将创建一个名为<code>name</code>的xsk映射，带有<code>size</code>个条目，并将其固定到bpffs作为一个文件。每个条目表示一个NIC的队列ID。该映射仅在XDP中用于将数据包重定向到AF_XDP套接字。如果AF_XDP套接字绑定到与当前数据包的队列ID不同的队列，则数据包将被丢弃。对于内核v5.3及更高版本，“lookup”方法可用于检查当前数据包的队列ID是否可用于AF_XDP套接字。有关详细信息，请参阅<a href="https://www.kernel.org/doc/html/latest/networking/af_xdp.html">AF_XDP</a>。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">BPF_XSKMAP</span><span class="p">(</span><span class="n">xsks_map</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
</code></pre></div>
<p>方法（稍后涵盖）：map.redirect_map()。map.lookup()</p>
<p>现场示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">search /examples</a>,</p>
<h3 id="14-bpf_array_of_maps">14. BPF_ARRAY_OF_MAPS</h3>
<p>语法：<code>BPF_ARRAY_OF_MAPS(name, inner_map_name, size)</code></p>
<p>这将创建一个带有映射内部类型（BPF_MAP_TYPE_HASH_OF_MAPS）的数组映射，名称为<code>name</code>，包含<code>size</code>个条目。映射的内部元数据由映射<code>inner_map_name</code>提供，可以是除了<code>BPF_MAP_TYPE_PROG_ARRAY</code>、<code>BPF_MAP_TYPE_CGROUP_STORAGE</code>和<code>BPF_MAP_TYPE_PERCPU_CGROUP_STORAGE</code>之外的大多数数组或哈希映射。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">BPF_TABLE</span><span class="p">(</span><span class="s">&quot;hash&quot;</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">ex1</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">);</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">BPF_TABLE</span><span class="p">(</span><span class="s">&quot;hash&quot;</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">ex2</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">);</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="n">BPF_ARRAY_OF_MAPS</span><span class="p">(</span><span class="n">maps_array</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ex1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
</code></pre></div>
<h3 id="15-bpf_hash_of_maps">15. BPF_HASH_OF_MAPS</h3>
<p>语法：<code>BPF_HASH_OF_MAPS(name, key_type, inner_map_name, size)</code></p>
<p>这将创建一个带有映射内部类型（BPF_MAP_TYPE_HASH_OF_MAPS）的哈希映射，名称为<code>name</code>，包含<code>size</code>个条目。映射的内部元数据由映射<code>inner_map_name</code>提供，可以是除了<code>BPF_MAP_TYPE_PROG_ARRAY</code>、<code>BPF_MAP_TYPE_CGROUP_STORAGE</code>和<code>BPF_MAP_TYPE_PERCPU_CGROUP_STORAGE</code>之外的大多数数组或哈希映射。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">BPF_ARRAY</span><span class="p">(</span><span class="n">ex1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">);</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="n">BPF_ARRAY</span><span class="p">(</span><span class="n">ex2</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">);</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="n">BPF_HASH_OF_MAPS</span><span class="p">(</span><span class="n">maps_hash</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">custom_key</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ex1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
</code></pre></div>
<h3 id="16-bpf_stack">16. BPF_STACK</h3>
<p>语法：<code>BPF_STACK(name, leaf_type, max_entries[, flags])</code>。创建一个名为 <code>name</code> 的堆栈，其值类型为 <code>leaf_type</code>，最大条目数为 <code>max_entries</code>。
堆栈和队列映射仅适用于 Linux 4.20+。</p>
<p>例如:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">BPF_STACK</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">event</span><span class="p">,</span><span class="w"> </span><span class="mi">10240</span><span class="p">);</span>
</code></pre></div>
<p>这将创建一个名为 <code>stack</code> 的堆栈，其值类型为 <code>struct event</code>，最多可容纳 10240 个条目。</p>
<p>方法（后面会涉及）：map.push()、map.pop()、map.peek()。</p>
<p>示例：</p>
<p>在 <a href="https://github.com/iovisor/bcc/tree/master/tests">search /tests</a> 中。</p>
<h3 id="17-bpf_queue">17. BPF_QUEUE</h3>
<p>语法：<code>BPF_QUEUE(name, leaf_type, max_entries[, flags])</code></p>
<p>创建一个名为 <code>name</code> 的队列，其值类型为 <code>leaf_type</code>，最大条目数为 <code>max_entries</code>。
堆栈和队列映射仅适用于 Linux 4.20+。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">BPF_QUEUE</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">event</span><span class="p">,</span><span class="w"> </span><span class="mi">10240</span><span class="p">);</span>
</code></pre></div>
<p>这将创建一个名为 <code>queue</code> 的队列，其值类型为 <code>struct event</code>，最多可容纳 10240 个条目。</p>
<p>方法（后面会涉及）：map.push()、map.pop()、map.peek()。</p>
<p>示例：</p>
<p>在 <a href="https://github.com/iovisor/bcc/tree/master/tests">search /tests</a> 中。</p>
<h3 id="18-bpf_sockhash">18. BPF_SOCKHASH</h3>
<p>语法：<code>BPF_SOCKHASH(name[, key_type [, max_entries)</code></p>
<p>创建一个名为 <code>name</code> 的哈希，带有可选参数。sockhash仅适用于Linux 4.18+。</p>
<p>默认值：<code>BPF_SOCKHASH(name, key_type=u32, max_entries=10240)</code></p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">sock_key</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">  </span><span class="n">u32</span><span class="w"> </span><span class="n">remote_ip4</span><span class="p">;</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">  </span><span class="n">u32</span><span class="w"> </span><span class="n">local_ip4</span><span class="p">;</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">  </span><span class="n">u32</span><span class="w"> </span><span class="n">remote_port</span><span class="p">;</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">  </span><span class="n">u32</span><span class="w"> </span><span class="n">local_port</span><span class="p">;</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="p">};</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="n">BPF_HASH</span><span class="p">(</span><span class="n">skh</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">sock_key</span><span class="p">,</span><span class="w"> </span><span class="mi">65535</span><span class="p">);</span>
</code></pre></div>
<p>这将创建一个名为 <code>skh</code> 的哈希表，其中键是 <code>struct sock_key</code>。</p>
<p>sockhash是一种BPF映射类型，它保存对sock结构体的引用。然后，通过使用新的sk/msg重定向BPF辅助函数，BPF程序可以使用该映射在套接字之间重定向skbs/msgs（<code>map.sk_redirect_hash()/map.msg_redirect_hash()</code>）。<code>BPF_SOCKHASH</code>和<code>BPF_SOCKMAP</code>的区别在于<code>BPF_SOCKMAP</code>是基于数组实现的，并且强制键为四个字节。
而<code>BPF_SOCKHASH</code>是基于哈希表实现的，并且键的类型可以自由指定。</p>
<p>方法（稍后介绍）：map.sock_hash_update()，map.msg_redirect_hash()，map.sk_redirect_hash()。</p>
<p><a href="https://github.com/iovisor/bcc/tree/master/tests">搜索/tests</a></p>
<h3 id="19-maplookup">19. map.lookup()</h3>
<p>语法：<code>*val map.lookup(&amp;key)</code></p>
<p>在映射中查找键，如果存在则返回指向其值的指针，否则返回NULL。我们将键作为指针的地址传入。</p>
<p>示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="20-maplookup_or_try_init">20. map.lookup_or_try_init()</h3>
<p>语法：<code>*val map.lookup_or_try_init(&amp;key, &amp;zero)</code></p>
<p>在映射中查找键，如果存在则返回指向其值的指针，否则将键的值初始化为第二个参数。通常用于将值初始化为零。如果无法插入键（例如映射已满），则返回NULL。</p>
<p>示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<p>注意：旧的map.lookup_or_init()可能导致函数返回，因此建议使用lookup_or_try_init()，它没有这种副作用。</p>
<h3 id="21-mapdelete">21. map.delete()</h3>
<p>语法：<code>map.delete(&amp;key)</code></p>
<p>从哈希表中删除键。</p>
<p>示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="22-mapupdate">22. map.update()</h3>
<p>语法：<code>map.update(&amp;key, &amp;val)</code></p>
<p>将第二个参数中的值与键关联，覆盖任何先前的值。</p>
<p>示例："<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="23-mapinsert">23. map.insert()</h3>
<p>语法: <code>map.insert(&amp;key, &amp;val)</code></p>
<p>将第二个参数中的值与键相关联，仅在之前没有值的情况下。</p>
<p>现场示例:
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="24-mapincrement">24. map.increment()</h3>
<p>语法: <code>map.increment(key[, increment_amount])</code></p>
<p>通过 <code>increment_amount</code>（默认为1）增加键的值。用于柱状图。</p>
<p><code>map.increment()</code>不是原子操作。在并发情况下，如果要获得更准确的结果，请使用 <code>map.atomic_increment()</code> 而不是 <code>map.increment()</code>。<code>map.increment()</code> 和 <code>map.atomic_increment()</code> 的开销相似。</p>
<p>注意. 当使用 <code>map.atomic_increment()</code> 操作类型为 <code>BPF_MAP_TYPE_HASH</code> 的 BPF map 时，如果指定的键不存在，则 <code>map.atomic_increment()</code> 无法保证操作的原子性。</p>
<p>现场示例:
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="25-mapget_stackid">25. map.get_stackid()</h3>
<p>语法: <code>int map.get_stackid(void *ctx, u64 flags)</code></p>
<p>这会遍历在 <code>ctx</code> 中找到的 struct pt_regs 中的堆栈，将其保存在堆栈跟踪 map 中，并返回一个唯一的堆栈跟踪 ID。</p>
<p>现场示例:
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="26-mapperf_read">26. map.perf_read()</h3>
<p>语法: <code>u64 map.perf_read(u32 cpu)</code></p>
<p>现场示例:""<a href="https://github.com/iovisor/bcc/tree/master/tests">搜索/tests</a></p>
<h3 id="27-mapcall">27. map.call()</h3>
<p>语法：<code>void map.call(void *ctx, int index)</code></p>
<p>这将调用<code>bpf_tail_call()</code>来尾调用<a href="#10-bpf_prog_array">BPF_PROG_ARRAY</a>中指向<code>index</code>入口的bpf程序。尾调用与普通调用不同。它在跳转到另一个bpf程序后重用当前的栈帧，并且不会返回。如果<code>index</code>入口为空，它将不会跳转到任何地方，程序的执行将会继续进行。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">BPF_PROG_ARRAY</span><span class="p">(</span><span class="n">prog_array</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">tail_call</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">    </span><span class="n">bpf_trace_printk</span><span class="p">(</span><span class="s">&quot;尾调用</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="p">}</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">do_tail_call</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">    </span><span class="n">bpf_trace_printk</span><span class="p">(</span><span class="s">&quot;原始的程序</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">    </span><span class="n">prog_array</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">b</span> <span class="o">=</span> <span class="n">BPF</span><span class="p">(</span><span class="n">src_file</span><span class="o">=</span><span class="s2">&quot;example.c&quot;</span><span class="p">)</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">tail_fn</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">load_func</span><span class="p">(</span><span class="s2">&quot;tail_call&quot;</span><span class="p">,</span> <span class="n">BPF</span><span class="o">.</span><span class="n">KPROBE</span><span class="p">)</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="n">prog_array</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="s2">&quot;prog_array&quot;</span><span class="p">)</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="n">prog_array</span><span class="p">[</span><span class="n">c_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">c_int</span><span class="p">(</span><span class="n">tail_fn</span><span class="o">.</span><span class="n">fd</span><span class="p">)</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_kprobe</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="s2">&quot;some_kprobe_event&quot;</span><span class="p">,</span> <span class="n">fn_name</span><span class="o">=</span><span class="s2">&quot;do_tail_call&quot;</span><span class="p">)</span>
</code></pre></div>
<p>这将<code>tail_call()</code>分配给<code>prog_array[2]</code>。在<code>do_tail_call()</code>的最后，<code>prog_array.call(ctx, 2)</code>尾调用<code>tail_call()</code>并执行它。</p>
<p><strong>注意：</strong>为了防止无限循环，尾调用的最大数量是32（<a href="https://github.com/torvalds/linux/search?l=C&amp;q=MAX_TAIL_CALL_CNT+path%3Ainclude%2Flinux&amp;type=Code"><code>MAX_TAIL_CALL_CNT</code></a>）。</p>
<p>在现场示例中：
<a href="https://github.com/iovisor/bcc/search?l=C&amp;q=call+path%3Aexamples&amp;type=Code">搜索/examples</a>,
<a href="https://github.com/iovisor/bcc/search?l=C&amp;q=call+path%3Atests&amp;type=Code">搜索/tests</a></p>
<h3 id="28-mapredirect_map">28. map.redirect_map()</h3>
<p>语法：<code>int map.redirect_map(int index, int flags)</code>".这将根据 <code>index</code> 条目重定向传入的数据包。如果映射是 <a href="#11-bpf_devmap">BPF_DEVMAP</a>，数据包将被发送到该条目指向的网络接口的传输队列。如果映射是 <a href="#12-bpf_cpumap">BPF_CPUMAP</a>，数据包将被发送到<code>index</code> CPU的环形缓冲区，并稍后由CPU处理。如果映射是 <a href="#13-bpf_xskmap">BPF_XSKMAP</a>，数据包将被发送到连接到队列的 AF_XDP 套接字。</p>
<p>如果数据包成功被重定向，该函数将返回 XDP_REDIRECT。否则，将返回 XDP_ABORTED 以丢弃该数据包。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">BPF_DEVMAP</span><span class="p">(</span><span class="n">devmap</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">redirect_example</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">xdp_md</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">devmap</span><span class="p">.</span><span class="n">redirect_map</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="p">}</span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="kt">int</span><span class="w"> </span><span class="nf">xdp_dummy</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">xdp_md</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XDP_PASS</span><span class="p">;</span>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">ip</span> <span class="o">=</span> <span class="n">pyroute2</span><span class="o">.</span><span class="n">IPRoute</span><span class="p">()</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="n">idx</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">link_lookup</span><span class="p">(</span><span class="n">ifname</span><span class="o">=</span><span class="s2">&quot;eth1&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="n">b</span> <span class="o">=</span> <span class="n">bcc</span><span class="o">.</span><span class="n">BPF</span><span class="p">(</span><span class="n">src_file</span><span class="o">=</span><span class="s2">&quot;example.c&quot;</span><span class="p">)</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="n">devmap</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="s2">&quot;devmap&quot;</span><span class="p">)</span>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="n">devmap</span><span class="p">[</span><span class="n">c_uint32</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">c_int</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="n">in_fn</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">load_func</span><span class="p">(</span><span class="s2">&quot;redirect_example&quot;</span><span class="p">,</span> <span class="n">BPF</span><span class="o">.</span><span class="n">XDP</span><span class="p">)</span>
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a><span class="n">out_fn</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">load_func</span><span class="p">(</span><span class="s2">&quot;xdp_dummy&quot;</span><span class="p">,</span> <span class="n">BPF</span><span class="o">.</span><span class="n">XDP</span><span class="p">)</span>
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_xdp</span><span class="p">(</span><span class="s2">&quot;eth0&quot;</span><span class="p">,</span> <span class="n">in_fn</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_xdp</span><span class="p">(</span><span class="s2">&quot;eth1&quot;</span><span class="p">,</span> <span class="n">out_fn</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div>
<p>示例位置：
<a href="https://github.com/iovisor/bcc/search?l=C&amp;q=redirect_map+path%3Aexamples&amp;type=Code">搜索 /examples</a>,</p>
<h3 id="29-mappush">29. map.push()</h3>
<p>语法：<code>int map.push(&amp;val, int flags)</code></p>
<p>将元素推入堆栈或队列表。将 BPF_EXIST 作为标志传递会导致队列或堆栈在已满时丢弃最旧的元素。成功返回0，失败返回负错误值。</p>
<p>示例位置：
<a href="https://github.com/iovisor/bcc/tree/master/tests">搜索 /tests</a>,</p>
<h3 id="30-mappop">30. map.pop()</h3>
<p>语法：<code>int map.pop(&amp;val)</code></p>
<p>从堆栈或队列表中弹出一个元素。<code>*val</code>被填充为结果。与查看不同，弹出操作会移除该元素。成功返回0，失败返回负错误值。</p>
<p>示例位置：
<a href="https://github.com/iovisor/bcc/tree/master/tests">搜索 /tests</a>,</p>
<h3 id="31-mappeek">31. map.peek()</h3>
<p>语法：<code>int map.peek(&amp;val)</code>查看堆栈或队列表头的元素。<code>*val</code>将被结果填充。
与弹出不同，查看不会删除元素。
成功返回0，失败返回负错误。</p>
<p>实例：
<a href="https://github.com/iovisor/bcc/tree/master/tests">搜索/tests</a></p>
<h3 id="32-mapsock_hash_update">32. map.sock_hash_update()</h3>
<p>语法：<code>int map.sock_hash_update(struct bpf_sock_ops *skops, &amp;key, int flags)</code></p>
<p>向sockhash映射添加条目或更新条目。skops用作与键相关联的条目的新值。flags为以下之一：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>BPF_NOEXIST：映射中不得存在key的条目。
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>BPF_EXIST：映射中必须已存在key的条目。
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>BPF_ANY：对于key的条目是否存在，没有条件。
</code></pre></div>
<p>如果映射具有eBPF程序（解析器和判决器），则这些程序将被添加的套接字继承。如果套接字已经附加到eBPF程序，则会出错。</p>
<p>成功返回0，失败返回负错误。</p>
<p>实例：
<a href="https://github.com/iovisor/bcc/tree/master/tests">搜索/tests</a></p>
<h3 id="33-mapmsg_redirect_hash">33. map.msg_redirect_hash()</h3>
<p>语法：<code>int map.msg_redirect_hash(struct sk_msg_buff *msg, void*key, u64 flags)</code></p>
<p>该辅助程序用于在套接字级别实施策略的程序中。如果消息msg被允许通过（即判决eBPF程序返回SK_PASS），则使用哈希键将其重定向到映射引用的套接字（类型为BPF_MAP_TYPE_SOCKHASH）。可以使用入站和出站接口进行重定向。标志中的BPF_F_INGRESS值用于区分（如果存在该标志，则选择入站路径，否则选择出站路径）。目前，这是唯一支持的标志。</p>
<p>成功返回SK_PASS，发生错误返回SK_DROP。</p>
<p>实例：
<a href="https://github.com/iovisor/bcc/tree/master/tests">搜索/tests</a></p>
<h3 id="34-mapsk_redirect_hash">34. map.sk_redirect_hash()</h3>
<p>语法：<code>int map.sk_redirect_hash(struct sk_buff *skb, void*key, u64 flags)</code>".This helper is used in programs implementing policies at the skb socket level.
If the sk_buff skb is allowed to pass (i.e. if the verdict eBPF program returns SK_PASS), redirect it to the socket referenced by map (of type BPF_MAP_TYPE_SOCKHASH) using hash key.
Both ingress and egress interfaces can be used for redirection.
The BPF_F_INGRESS value in flags is used to make the distinction (ingress path is selected if the flag is present, egress otherwise).
This is the only flag supported for now.</p>
<p>Return SK_PASS on success, or SK_DROP on error.</p>
<p>Examples in situ:
[搜索/tests](&lt;https://github.com/iovisor/bcc/tree/master/tests),</p>
<h2 id="_6">许可证</h2>
<p>Depending on which [BPF helpers](kernel-versions.md#helpers) are used, a GPL-compatible license is required.</p>
<p>The special BCC macro <code>BPF_LICENSE</code> specifies the license of the BPF program.
You can set the license as a comment in your source code, but the kernel has a special interface to specify it programmatically.
If you need to use GPL-only helpers, it is recommended to specify the macro in your C code so that the kernel can understand it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1">// SPDX-License-Identifier: GPL-2.0+</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="cp">#define BPF_LICENSE GPL</span>
</code></pre></div>
<p>Otherwise, the kernel may reject loading your program (see the [错误描述](#2-cannot-call-gpl-only-function-from-proprietary-program) below).
Note that it supports multiple words and quotes are not necessary:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1">// SPDX-License-Identifier: GPL-2.0+ OR BSD-2-Clause</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="cp">#define BPF_LICENSE Dual BSD/GPL</span>
</code></pre></div>
<p>Check the [BPF helpers reference](kernel-versions.md#helpers) to see which helpers are GPL-only and what the kernel understands as GPL-compatible.</p>
<p><strong>If the macro is not specified, BCC will automatically define the license of the program as GPL.</strong></p>
<h2 id="rewriter">Rewriter</h2>
<p>一个重写器的工作是使用内核辅助程序将隐式内存访问转换为显式内存访问。最近的内核引入了一个配置选项ARCH_HAS_NON_OVERLAPPING_ADDRESS_SPACE，该选项将被设置为使用用户地址空间和内核地址空间不重叠的体系结构。x86和arm设置了这个配置选项，而s390没有。如果没有设置ARCH_HAS_NON_OVERLAPPING_ADDRESS_SPACE，bpf旧帮助函数<code>bpf_probe_read()</code>将不可用。一些现有的用户可能有隐式内存访问来访问用户内存，所以使用<code>bpf_probe_read_kernel()</code>会导致他们的应用程序失败。因此，对于非s390，重写器将对这些隐式内存访问使用<code>bpf_probe_read()</code>。对于s390，默认使用<code>bpf_probe_read_kernel()</code>，用户在访问用户内存时应显式使用<code>bpf_probe_read_user()</code></p>
<h1 id="bcc-python">bcc Python</h1>
<h2 id="_7">初始化</h2>
<p>构造函数。</p>
<h3 id="1-bpf">1. BPF</h3>
<p>语法: <code>BPF({text=BPF_program | src_file=filename} [, usdt_contexts=[USDT_object, ...]] [, cflags=[arg1, ...]] [, debug=int])</code></p>
<p>创建一个BPF对象。这是定义BPF程序并与其输出交互的主要对象。</p>
<p>必须提供<code>text</code>或<code>src_file</code>之一，不能两者都提供。</p>
<p><code>cflags</code>指定要传递给编译器的额外参数，例如<code>-DMACRO_NAME=value</code>或<code>-I/include/path</code>。参数以数组形式传递，每个元素为一个额外的参数。注意，字符串不会按空格拆分，所以每个参数必须是数组的不同元素，例如<code>["-include", "header.h"]</code>。</p>
<p><code>debug</code>标志控制调试输出，可以使用或运算:</p>
<ul>
<li><code>DEBUG_LLVM_IR = 0x1</code> 编译后的LLVM IR</li>
<li><code>DEBUG_BPF = 0x2</code> 加载的BPF字节码和分支时的寄存器状态</li>
<li><code>DEBUG_PREPROCESSOR = 0x4</code> 预处理器的结果</li>
<li><code>DEBUG_SOURCE = 0x8</code> 嵌入源码的ASM指令</li>
<li><code>DEBUG_BPF_REGISTER_STATE = 0x10</code> 所有指令的寄存器状态，额外打印DEBUG_BPF的信息</li>
<li><code>DEBUG_BTF = 0x20</code> 打印来自<code>libbpf</code>库的消息。</li>
</ul>
<p>示例:</p>
<p>```Python"# 定义整个BPF程序在一行中:
BPF(text='int do_trace(void *ctx) { bpf_trace_printk("命中！\n"); return 0; }');</p>
<h1 id="_8">定义程序为一个变量:</h1>
<p>prog = """
int hello(void *ctx) {
    bpf_trace_printk("你好，世界！\n");
    return 0;
}
"""
b = BPF(text=prog)</p>
<h1 id="_9">源文件:</h1>
<p>b = BPF(src_file = "vfsreadlat.c")</p>
<h1 id="usdt">包括一个USDT对象:</h1>
<p>u = USDT(pid=int(pid))
[...]
b = BPF(text=bpf_text, usdt_contexts=[u])</p>
<h1 id="_10">添加包含路径:</h1>
<p>u = BPF(text=prog, cflags=["-I/path/to/include"])</p>
<p>在原地的示例:
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /tools</a></p>
<h3 id="2-usdt">2. USDT</h3>
<p>语法: <code>USDT({pid=pid | path=path})</code></p>
<p>创建一个对象以检测用户静态定义的跟踪(USDT)探针。它的主要方法是<code>enable_probe()</code>。</p>
<p>参数:</p>
<ul>
<li>pid: 附加到该进程ID。</li>
<li>path: 从此二进制路径检测USDT探针。</li>
</ul>
<p>示例:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1"># 包括一个USDT对象:</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="n">u</span> <span class="o">=</span> <span class="n">USDT</span><span class="p">(</span><span class="n">pid</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="p">[</span><span class="o">...</span><span class="p">]</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="n">b</span> <span class="o">=</span> <span class="n">BPF</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">bpf_text</span><span class="p">,</span> <span class="n">usdt_contexts</span><span class="o">=</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
</code></pre></div>
<p>在原地的示例:
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /tools</a></p>
<h2 id="_11">事件</h2>
<h3 id="1-attach_kprobe">1. attach_kprobe()</h3>
<p>语法: <code>BPF.attach_kprobe(event="event", fn_name="name")</code></p>
<p>通过内核动态跟踪函数入口，来检测内核函数<code>event()</code>，并将我们的C定义的函数<code>name()</code>附加到每次调用内核函数时被调用。</p>
<p>例如:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_kprobe</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="s2">&quot;sys_clone&quot;</span><span class="p">,</span> <span class="n">fn_name</span><span class="o">=</span><span class="s2">&quot;do_trace&quot;</span><span class="p">)</span>
</code></pre></div>
<p>这将检测内核<code>sys_clone()</code>函数，并在每次调用时运行我们定义的BPF函数<code>do_trace()</code>。</p>
<p>您可以多次调用attach_kprobe()，并将您的BPF函数附加到多个内核函数上。您也可以多次调用attach_kprobe()函数将多个BPF函数附加到同一个内核函数。</p>
<p>有关如何从BPF中提取参数的详细信息，请参阅前面的kprobes部分。</p>
<p>示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">查找/examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">查找/tools</a></p>
<h3 id="2-attach_kretprobe">2. attach_kretprobe()</h3>
<p>语法：BPF.attach_kretprobe(event="事件", fn_name="名称" [, maxactive=int])</p>
<p>使用内核动态跟踪函数返回来检测内核函数event()的返回，并附加我们定义的C函数name()在内核函数返回时调用。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_kretprobe</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="s2">&quot;vfs_read&quot;</span><span class="p">,</span> <span class="n">fn_name</span><span class="o">=</span><span class="s2">&quot;do_return&quot;</span><span class="p">)</span>
</code></pre></div>
<p>这将检测内核的vfs_read()函数，每次调用该函数时都会执行我们定义的BPF函数do_return()。</p>
<p>您可以多次调用attach_kretprobe()函数，并将您的BPF函数附加到多个内核函数的返回值。
您也可以多次调用attach_kretprobe()函数将多个BPF函数附加到同一个内核函数的返回值。</p>
<p>当在内核函数上安装kretprobe时，它可以捕获的并行调用次数存在限制。您可以使用maxactive参数更改该限制。有关默认值，请参阅kprobes文档。</p>
<p>有关如何从BPF中提取返回值的详细信息，请参阅前面的kretprobes部分。</p>
<p>示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">查找/examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">查找/tools</a></p>
<h3 id="3-attach_tracepoint">3. attach_tracepoint()</h3>
<p>语法：BPF.attach_tracepoint(tp="追踪点", fn_name="名称")</p>
<p>检测由tracepoint描述的内核追踪点，并在命中时运行BPF函数name()。这是一种显式方式来操控 tracepoints。在前面的 tracepoints 部分讲解过的 <code>TRACEPOINT_PROBE</code> 语法是另一种方法，其优点是自动声明一个包含 tracepoint 参数的 <code>args</code> 结构体。在使用 <code>attach_tracepoint()</code> 时，tracepoint 参数需要在 BPF 程序中声明。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c1"># 定义 BPF 程序</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="n">bpf_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="s2">#include &lt;uapi/linux/ptrace.h&gt;</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="s2">struct urandom_read_args {</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="s2">    // 来自 /sys/kernel/debug/tracing/events/random/urandom_read/format</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="s2">    u64 __unused__;</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="s2">    u32 got_bits;</span>
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="s2">    u32 pool_left;</span>
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="s2">    u32 input_left;</span>
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="s2">};</span>
<a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a>
<a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="s2">int printarg(struct urandom_read_args *args) {</span>
<a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a><span class="s2">    bpf_trace_printk(&quot;</span><span class="si">%d</span><span class="se">\\</span><span class="s2">n&quot;, args-&gt;got_bits);</span>
<a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a><span class="s2">    return 0;</span>
<a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a><span class="s2">};</span>
<a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a>
<a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a><span class="c1"># 加载 BPF 程序</span>
<a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a><span class="n">b</span> <span class="o">=</span> <span class="n">BPF</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">bpf_text</span><span class="p">)</span>
<a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_tracepoint</span><span class="p">(</span><span class="s2">&quot;random:urandom_read&quot;</span><span class="p">,</span> <span class="s2">&quot;printarg&quot;</span><span class="p">)</span>
</code></pre></div>
<p>注意，<code>printarg()</code> 的第一个参数现在是我们定义的结构体。</p>
<p>代码示例：
<a href="https://github.com/iovisor/bcc/blob/a4159da8c4ea8a05a3c6e402451f530d6e5a8b41/examples/tracing/urandomread-explicit.py#L41">code</a>,
<a href="https://github.com/iovisor/bcc/tree/master/examples">search /examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">search /tools</a></p>
<h3 id="4-attach_uprobe">4. attach_uprobe()</h3>
<p>语法：<code>BPF.attach_uprobe(name="location", sym="symbol", fn_name="name" [, sym_off=int])</code>, <code>BPF.attach_uprobe(name="location", sym_re="regex", fn_name="name")</code>, <code>BPF.attach_uprobe(name="location", addr=int, fn_name="name")</code></p>
<p>用于操控位于 <code>location</code> 中的库或二进制文件中的用户级别函数 <code>symbol()</code>，使用用户级别动态跟踪该函数的入口，并将我们定义的 C 函数 <code>name()</code> 附加为在用户级别函数被调用时调用的函数。如果给定了 <code>sym_off</code>，则该函数将附加到符号的偏移量上。真实的地址<code>addr</code>可以替代<code>sym</code>，在这种情况下，<code>sym</code>必须设置为其默认值。如果文件是非PIE可执行文件，则<code>addr</code>必须是虚拟地址，否则它必须是相对于文件加载地址的偏移量。</p>
<p>可以在<code>sym_re</code>中提供普通表达式来代替符号名称。然后，uprobes将附加到与提供的正则表达式匹配的符号。</p>
<p>在名字参数中可以给出库名而不带lib前缀，或者给出完整路径（/usr/lib/...）。只能通过完整路径（/bin/sh）给出二进制文件。</p>
<p>例如:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_uprobe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="s2">&quot;strlen&quot;</span><span class="p">,</span> <span class="n">fn_name</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
</code></pre></div>
<p>这将在libc中对<code>strlen()</code>函数进行插装，并在调用该函数时调用我们的BPF函数<code>count()</code>。请注意，在<code>libc</code>中的<code>libc</code>中的"lib"是不必要的。</p>
<p>其他例子:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_uprobe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="s2">&quot;getaddrinfo&quot;</span><span class="p">,</span> <span class="n">fn_name</span><span class="o">=</span><span class="s2">&quot;do_entry&quot;</span><span class="p">)</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_uprobe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;/usr/bin/python&quot;</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">fn_name</span><span class="o">=</span><span class="s2">&quot;do_main&quot;</span><span class="p">)</span>
</code></pre></div>
<p>您可以多次调用attach_uprobe()，并将BPF函数附加到多个用户级函数。</p>
<p>有关如何从BPF工具获取参数的详细信息，请参见上一节uprobes。</p>
<p>原址示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">search /examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">search /tools</a></p>
<h3 id="5-attach_uretprobe">5. attach_uretprobe()</h3>
<p>语法: <code>BPF.attach_uretprobe(name="location", sym="symbol", fn_name="name")</code></p>
<p>使用用户级动态跟踪从名为<code>location</code>的库或二进制文件中的用户级函数<code>symbol()</code>返回值的方式仪器化，并将我们定义的C函数<code>name()</code>附加到用户级函数返回时调用。</p>
<p>例如:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_uretprobe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="s2">&quot;strlen&quot;</span><span class="p">,</span> <span class="n">fn_name</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="err">```。</span><span class="n">这将使用libc库对</span><span class="err">```</span><span class="n">strlen</span><span class="p">()</span><span class="err">```</span><span class="n">函数进行插装</span><span class="err">，</span><span class="n">并在其返回时调用我们的BPF函数</span><span class="err">```</span><span class="n">count</span><span class="p">()</span><span class="err">```。</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="n">其他示例</span><span class="err">：</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="err">```</span><span class="n">Python</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_uretprobe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="s2">&quot;getaddrinfo&quot;</span><span class="p">,</span> <span class="n">fn_name</span><span class="o">=</span><span class="s2">&quot;do_return&quot;</span><span class="p">)</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_uretprobe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;/usr/bin/python&quot;</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">fn_name</span><span class="o">=</span><span class="s2">&quot;do_main&quot;</span><span class="p">)</span>
</code></pre></div>
<p>您可以多次调用attach_uretprobe()，并将您的BPF函数附加到多个用户级函数上。</p>
<p>有关如何对BPF返回值进行插装的详细信息，请参阅前面的uretprobes部分。</p>
<p>内部示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="6-usdtenable_probe">6. USDT.enable_probe()</h3>
<p>语法：<code>USDT.enable_probe(probe=probe, fn_name=name)</code></p>
<p>将BPF C函数<code>name</code>附加到USDT探针<code>probe</code>。</p>
<p>示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="c1"># 根据给定的PID启用USDT探针</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="n">u</span> <span class="o">=</span> <span class="n">USDT</span><span class="p">(</span><span class="n">pid</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="n">u</span><span class="o">.</span><span class="n">enable_probe</span><span class="p">(</span><span class="n">probe</span><span class="o">=</span><span class="s2">&quot;http__server__request&quot;</span><span class="p">,</span> <span class="n">fn_name</span><span class="o">=</span><span class="s2">&quot;do_trace&quot;</span><span class="p">)</span>
</code></pre></div>
<p>要检查您的二进制文件是否具有USDT探针以及它们的详细信息，可以运行<code>readelf -n binary</code>并检查stap调试部分。</p>
<p>内部示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="7-attach_raw_tracepoint">7. attach_raw_tracepoint()</h3>
<p>语法：<code>BPF.attach_raw_tracepoint(tp="tracepoint", fn_name="name")</code></p>
<p>对由<code>tracepoint</code>（仅<code>event</code>，无<code>category</code>）描述的内核原始跟踪点进行插装，并在命中时运行BPF函数<code>name()</code>。</p>
<p>这是一种明确的插装跟踪点的方法。早期原始跟踪点部分介绍的<code>RAW_TRACEPOINT_PROBE</code>语法是一种替代方法。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_raw_tracepoint</span><span class="p">(</span><span class="s2">&quot;sched_switch&quot;</span><span class="p">,</span> <span class="s2">&quot;do_trace&quot;</span><span class="p">)</span>
</code></pre></div>
<p>内部示例："."<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /工具</a></p>
<h3 id="8-attach_raw_socket">8. attach_raw_socket()</h3>
<p>语法: <code>BPF.attach_raw_socket(fn, dev)</code></p>
<p>将一个BPF函数附加到指定的网络接口。</p>
<p><code>fn</code> 必须是 <code>BPF.function</code> 类型，并且 bpf_prog 类型需要是 <code>BPF_PROG_TYPE_SOCKET_FILTER</code>  (<code>fn=BPF.load_func(func_name, BPF.SOCKET_FILTER)</code>)</p>
<p><code>fn.sock</code> 是一个非阻塞原始套接字，已经创建并绑定到 <code>dev</code>。</p>
<p>所有处理 <code>dev</code> 的网络数据包都会在经过 bpf_prog 处理后，被复制到 <code>fn.sock</code> 的 <code>recv-q</code> 中。可以使用 <code>recv/recvfrom/recvmsg</code> 来从 <code>fn.sock</code> 接收数据包。需要注意的是，如果在 <code>recv-q</code> 满了之后没有及时读取，复制的数据包将会被丢弃。</p>
<p>可以使用这个功能来像 <code>tcpdump</code> 一样捕获网络数据包。</p>
<p>可以使用<code>ss --bpf --packet -p</code>来观察 <code>fn.sock</code>。</p>
<p>示例:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="n">BPF</span><span class="o">.</span><span class="n">attach_raw_socket</span><span class="p">(</span><span class="n">bpf_func</span><span class="p">,</span> <span class="n">ifname</span><span class="p">)</span>
</code></pre></div>
<p>示例位置:
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /示例</a></p>
<h3 id="9-attach_xdp">9. attach_xdp()</h3>
<p>语法: <code>BPF.attach_xdp(dev="device", fn=b.load_func("fn_name",BPF.XDP), flags)</code></p>
<p>改装由 <code>dev</code> 描述的网络驱动程序，然后接收数据包，并使用标志运行 BPF 函数 <code>fn_name()</code>。</p>
<p>以下是可选的标志列表。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="c1"># from xdp_flags uapi/linux/if_link.h</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="n">XDP_FLAGS_UPDATE_IF_NOEXIST</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="n">XDP_FLAGS_SKB_MODE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="n">XDP_FLAGS_DRV_MODE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="n">XDP_FLAGS_HW_MODE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="n">XDP_FLAGS_REPLACE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span>
</code></pre></div>
<p>您可以像这样使用标志: <code>BPF.attach_xdp(dev="device", fn=b.load_func("fn_name",BPF.XDP), flags=BPF.XDP_FLAGS_UPDATE_IF_NOEXIST)</code></p>
<p>标志的默认值为0。这意味着如果没有带有 <code>device</code> 的xdp程序，fn将在该设备上运行。如果有一个正在运行的xdp程序与设备关联，旧程序将被新的fn程序替换。".当前，bcc不支持XDP_FLAGS_REPLACE标志。以下是其他标志的描述。</p>
<h4 id="1-xdp_flags_update_if_noexist">1. XDP_FLAGS_UPDATE_IF_NOEXIST</h4>
<p>如果已经将XDP程序附加到指定的驱动程序上，再次附加XDP程序将失败。</p>
<h4 id="2-xdp_flags_skb_mode">2. XDP_FLAGS_SKB_MODE</h4>
<p>驱动程序不支持XDP，但内核模拟支持它。
XDP程序可以工作，但没有真正的性能优势，因为数据包无论如何都会传递给内核堆栈，然后模拟XDP - 这通常适用于家用电脑，笔记本电脑和虚拟化硬件所使用的通用网络驱动程序。</p>
<h4 id="3-xdp_flags_drv_mode">3. XDP_FLAGS_DRV_MODE</h4>
<p>驱动程序具有XDP支持，并且可以将数据包直接传递给XDP，无需内核堆栈交互 - 少数驱动程序可以支持此功能，通常用于企业级硬件。</p>
<h4 id="4-xdp_flags_hw_mode">4. XDP_FLAGS_HW_MODE</h4>
<p>XDP可以直接在NIC上加载和执行 - 只有少数NIC支持这一功能。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_xdp</span><span class="p">(</span><span class="n">dev</span><span class="o">=</span><span class="s2">&quot;ens1&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">load_func</span><span class="p">(</span><span class="s2">&quot;do_xdp&quot;</span><span class="p">,</span> <span class="n">BPF</span><span class="o">.</span><span class="n">XDP</span><span class="p">))</span>
</code></pre></div>
<p>这将为网络设备<code>ens1</code>安装工具，并在接收数据包时运行我们定义的BPF函数<code>do_xdp()</code>。</p>
<p>不要忘记在最后调用<code>b.remove_xdp("ens1")</code>！</p>
<p>示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索/examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索/tools</a></p>
<h3 id="10-attach_func">10. attach_func()</h3>
<p>语法：<code>BPF.attach_func(fn, attachable_fd, attach_type [, flags])</code></p>
<p>将指定类型的BPF函数附加到特定的<code>attachable_fd</code>上。如果<code>attach_type</code>是<code>BPF_FLOW_DISSECTOR</code>，则预期该函数将附加到当前的网络命名空间，并且<code>attachable_fd</code>必须为0。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_func</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">cgroup_fd</span><span class="p">,</span> <span class="n">BPFAttachType</span><span class="o">.</span><span class="n">CGROUP_SOCK_OPS</span><span class="p">)</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_func</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">map_fd</span><span class="p">,</span> <span class="n">BPFAttachType</span><span class="o">.</span><span class="n">SK_MSG_VERDICT</span><span class="p">)</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="err">```</span><span class="n">注意</span><span class="err">。</span><span class="n">当附加到</span><span class="err">“</span><span class="n">全局</span><span class="err">”</span><span class="n">钩子</span><span class="err">（</span><span class="n">xdp</span><span class="err">、</span><span class="n">tc</span><span class="err">、</span><span class="n">lwt</span><span class="err">、</span><span class="n">cgroup</span><span class="err">）</span><span class="n">时</span><span class="err">。</span><span class="n">如果程序终止后不再需要</span><span class="err">“</span><span class="n">BPF</span> <span class="n">函数</span><span class="err">”，</span><span class="n">请确保在程序退出时调用</span> <span class="err">`</span><span class="n">detach_func</span><span class="err">`。</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="n">示例中的内部代码</span><span class="err">：</span>
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="p">[</span><span class="n">search</span> <span class="o">/</span><span class="n">examples</span><span class="p">](</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">iovisor</span><span class="o">/</span><span class="n">bcc</span><span class="o">/</span><span class="n">tree</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">examples</span><span class="p">),</span>
<a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a>
<a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="c1">### 11. detach_func()</span>
<a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>
<a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a><span class="n">语法</span><span class="err">：```</span><span class="n">BPF</span><span class="o">.</span><span class="n">detach_func</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">attachable_fd</span><span class="p">,</span> <span class="n">attach_type</span><span class="p">)</span><span class="err">```</span>
<a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a>
<a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="n">断开指定类型的</span> <span class="n">BPF</span> <span class="n">函数</span><span class="err">。</span>
<a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a>
<a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a><span class="n">例如</span><span class="err">：</span>
<a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a>
<a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a><span class="err">```</span><span class="n">Python</span>
<a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a><span class="n">b</span><span class="o">.</span><span class="n">detach_func</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">cgroup_fd</span><span class="p">,</span> <span class="n">BPFAttachType</span><span class="o">.</span><span class="n">CGROUP_SOCK_OPS</span><span class="p">)</span>  <span class="o">//</span> <span class="n">断开</span> <span class="n">cgroup_fd</span> <span class="n">上的</span> <span class="n">fn</span> <span class="n">函数</span>
<a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a><span class="n">b</span><span class="o">.</span><span class="n">detach_func</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">map_fd</span><span class="p">,</span> <span class="n">BPFAttachType</span><span class="o">.</span><span class="n">SK_MSG_VERDICT</span><span class="p">)</span>  <span class="o">//</span> <span class="n">断开</span> <span class="n">map_fd</span> <span class="n">上的</span> <span class="n">fn</span> <span class="n">函数</span>
</code></pre></div>
<p>示例中的内部代码：</p>
<p><a href="https://github.com/iovisor/bcc/tree/master/examples">search /examples</a>,</p>
<h3 id="12-detach_kprobe">12. detach_kprobe()</h3>
<p>语法：<code>BPF.detach_kprobe(event="event", fn_name="name")</code></p>
<p>断开指定事件的 kprobe 处理函数。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="n">b</span><span class="o">.</span><span class="n">detach_kprobe</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="s2">&quot;__page_cache_alloc&quot;</span><span class="p">,</span> <span class="n">fn_name</span><span class="o">=</span><span class="s2">&quot;trace_func_entry&quot;</span><span class="p">)</span>  <span class="o">//</span> <span class="n">断开</span> <span class="s2">&quot;__page_cache_alloc&quot;</span> <span class="n">事件上的</span> <span class="s2">&quot;trace_func_entry&quot;</span> <span class="n">函数</span>
</code></pre></div>
<h3 id="13-detach_kretprobe">13. detach_kretprobe()</h3>
<p>语法：<code>BPF.detach_kretprobe(event="event", fn_name="name")</code></p>
<p>断开指定事件的 kretprobe 处理函数。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="n">b</span><span class="o">.</span><span class="n">detach_kretprobe</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="s2">&quot;__page_cache_alloc&quot;</span><span class="p">,</span> <span class="n">fn_name</span><span class="o">=</span><span class="s2">&quot;trace_func_return&quot;</span><span class="p">)</span>  <span class="o">//</span> <span class="n">断开</span> <span class="s2">&quot;__page_cache_alloc&quot;</span> <span class="n">事件上的</span> <span class="s2">&quot;trace_func_return&quot;</span> <span class="n">函数</span>
</code></pre></div>
<h2 id="_12">调试输出</h2>
<h3 id="1-trace_print">1. trace_print()</h3>
<p>语法：<code>BPF.trace_print(fmt="fields")</code></p>
<p>该方法持续读取全局共享的 <code>/sys/kernel/debug/tracing/trace_pipe</code> 文件并打印其内容。可以通过 BPF 和 <code>bpf_trace_printk()</code> 函数将数据写入该文件，但该方法存在限制，包括缺乏并发跟踪支持。更推荐使用前面介绍的 BPF_PERF_OUTPUT 机制。</p>
<p>参数：</p>
<ul>
<li><code>fmt</code>: 可选，可以包含字段格式化字符串，默认为 <code>None</code>。</li>
</ul>
<p>示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="c1"># 将 trace_pipe 输出原样打印：</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="n">b</span><span class="o">.</span><span class="n">trace_print</span><span class="p">()</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="c1"># 打印 PID 和消息：</span>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="n">b</span><span class="o">.</span><span class="n">trace_print</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{1}</span><span class="s2"> </span><span class="si">{5}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p>示例中的内部代码：
<a href="https://github.com/iovisor/bcc/tree/master/examples">search /examples</a>。"<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /工具</a></p>
<h3 id="2-trace_fields">2. trace_fields()</h3>
<p>语法: <code>BPF.trace_fields(nonblocking=False)</code></p>
<p>该方法从全局共享的 /sys/kernel/debug/tracing/trace_pipe 文件中读取一行，并将其作为字段返回。该文件可以通过 BPF 和 bpf_trace_printk() 函数进行写入，但该方法有一些限制，包括缺乏并发追踪支持。我们更推荐使用之前介绍的 BPF_PERF_OUTPUT 机制。</p>
<p>参数:</p>
<ul>
<li><code>nonblocking</code>: 可选参数，默认为 <code>False</code>。当设置为 <code>True</code> 时，程序将不会阻塞等待输入。</li>
</ul>
<p>示例:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>        <span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">trace_fields</span><span class="p">()</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>        <span class="k">continue</span>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>    <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</code></pre></div>
<p>内联示例:
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /示例</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /工具</a></p>
<h2 id="api">输出 API</h2>
<p>BPF 程序的正常输出有两种方式:</p>
<ul>
<li>每个事件: 使用 PERF_EVENT_OUTPUT、open_perf_buffer() 和 perf_buffer_poll()。</li>
<li>map 汇总: 使用 items() 或 print_log2_hist()，在 Maps 部分有介绍。</li>
</ul>
<h3 id="1-perf_buffer_poll">1. perf_buffer_poll()</h3>
<p>语法: <code>BPF.perf_buffer_poll(timeout=T)</code></p>
<p>该方法从所有打开的 perf 环形缓冲区中轮询，并对每个条目调用在调用 open_perf_buffer 时提供的回调函数。</p>
<p>timeout 参数是可选的，并以毫秒为单位计量。如果未提供，则轮询将无限期进行。</p>
<p>示例:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="c1"># 循环调用带有回调函数 print_event 的 open_perf_buffer</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="n">b</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">open_perf_buffer</span><span class="p">(</span><span class="n">print_event</span><span class="p">)</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>        <span class="n">b</span><span class="o">.</span><span class="n">perf_buffer_poll</span><span class="p">()</span>
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a>    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>        <span class="n">exit</span><span class="p">()</span>
</code></pre></div>
<p>内联示例:
<a href="https://github.com/iovisor/bcc/blob/v0.9.0/examples/tracing/hello_perf_output.py#L55">代码</a>"."<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /示例</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /工具</a></p>
<h3 id="2-ring_buffer_poll">2. ring_buffer_poll()</h3>
<p>语法: <code>BPF.ring_buffer_poll(timeout=T)</code></p>
<p>这个方法从所有已打开的ringbuf环形缓冲区中轮询数据，对每个条目调用在调用open_ring_buffer时提供的回调函数。</p>
<p>timeout参数是可选的，以毫秒为单位测量。如果没有指定，轮询将持续到没有更多的数据或回调函数返回负值。</p>
<p>示例:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="c1"># 循环使用回调函数print_event</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="n">b</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">open_ring_buffer</span><span class="p">(</span><span class="n">print_event</span><span class="p">)</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>        <span class="n">b</span><span class="o">.</span><span class="n">ring_buffer_poll</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a>    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>        <span class="n">exit</span><span class="p">();</span>
</code></pre></div>
<p>示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /示例</a>,</p>
<h3 id="3-ring_buffer_consume">3. ring_buffer_consume()</h3>
<p>语法: <code>BPF.ring_buffer_consume()</code></p>
<p>这个方法从所有已打开的ringbuf环形缓冲区中消费数据，对每个条目调用在调用open_ring_buffer时提供的回调函数。</p>
<p>与<code>ring_buffer_poll</code>不同，这个方法在尝试消费数据之前<strong>不会轮询数据</strong>。这样可以减少延迟，但会增加CPU消耗。如果不确定使用哪种方法，建议使用<code>ring_buffer_poll</code>。</p>
<p>示例:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="c1"># 循环使用回调函数print_event</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="n">b</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">open_ring_buffer</span><span class="p">(</span><span class="n">print_event</span><span class="p">)</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a>        <span class="n">b</span><span class="o">.</span><span class="n">ring_buffer_consume</span><span class="p">()</span>
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a>    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a>        <span class="n">exit</span><span class="p">();</span>
</code></pre></div>
<p>示例：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /示例</a>,</p>
<h2 id="map-apis">Map APIs</h2>
<p>Maps是BPF数据存储器，在bcc中用于实现表、哈希和直方图等更高层次的对象。</p>
<h3 id="1-get_table">1. get_table()</h3>
<p>语法: <code>BPF.get_table(name)</code>".返回一个table对象。由于可以将表格作为BPF项进行读取，因此此功能不再使用。例如：<code>BPF[name]</code>。</p>
<p>示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="n">counts</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="s2">&quot;counts&quot;</span><span class="p">)</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="n">counts</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="s2">&quot;counts&quot;</span><span class="p">]</span>
</code></pre></div>
<p>这两者是等价的。</p>
<h3 id="2-open_perf_buffer">2. open_perf_buffer()</h3>
<p>语法：<code>table.open_perf_buffers(callback, page_cnt=N, lost_cb=None)</code></p>
<p>此操作基于BPF中定义的表格（<code>BPF_PERF_OUTPUT()</code>），将回调Python函数<code>callback</code>关联到在perf环形缓冲区中有数据可用时调用。这是从内核传输每个事件的数据到用户空间的推荐机制的一部分。可以通过<code>page_cnt</code>参数指定perf环形缓冲区的大小，默认为8个页面，必须是页数的2的幂次方。如果回调函数不能快速处理数据，则可能丢失某些提交的数据。<code>lost_cb</code>用于记录/监视丢失的计数。如果<code>lost_cb</code>是默认的<code>None</code>值，则只会打印一行消息到<code>stderr</code>。</p>
<p>示例：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="c1"># 处理事件</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="k">def</span> <span class="nf">print_event</span><span class="p">(</span><span class="n">cpu</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>    <span class="n">event</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ct</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">Data</span><span class="p">))</span><span class="o">.</span><span class="n">contents</span>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>    <span class="p">[</span><span class="o">...</span><span class="p">]</span>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a>
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="c1"># 循环通过回调函数打印事件</span>
<a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="n">b</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">open_perf_buffer</span><span class="p">(</span><span class="n">print_event</span><span class="p">)</span>
<a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a>        <span class="n">b</span><span class="o">.</span><span class="n">perf_buffer_poll</span><span class="p">()</span>
<a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a>    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a>        <span class="n">exit</span><span class="p">()</span>
</code></pre></div>
<p>请注意，传输的数据结构需要在BPF程序中以C方式声明。例如：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="c1">// 在C中定义输出数据结构</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">data_t</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="w">    </span><span class="n">u32</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="w">    </span><span class="n">u64</span><span class="w"> </span><span class="n">ts</span><span class="p">;</span>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">comm</span><span class="p">[</span><span class="n">TASK_COMM_LEN</span><span class="p">];</span>
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="p">};</span>
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="n">BPF_PERF_OUTPUT</span><span class="p">(</span><span class="n">events</span><span class="p">);</span>
<a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="p">[...]</span>
</code></pre></div>
<p>在Python中，您可以让bcc自动生成C声明中的数据结构（建议方法）：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="k">def</span> <span class="nf">print_event</span><span class="p">(</span><span class="n">cpu</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>    <span class="n">event</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="p">[</span><span class="o">...</span><span class="p">]</span>
</code></pre></div>
<p>或者手动定义：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="c1"># 在Python中定义输出数据结构</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="n">TASK_COMM_LEN</span> <span class="o">=</span> <span class="mi">16</span>    <span class="c1"># linux/sched.h</span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="k">class</span> <span class="nc">Data</span><span class="p">(</span><span class="n">ct</span><span class="o">.</span><span class="n">Structure</span><span class="p">):</span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a>    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;pid&quot;</span><span class="p">,</span> <span class="n">ct</span><span class="o">.</span><span class="n">c_ulonglong</span><span class="p">),</span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>                <span class="p">(</span><span class="s2">&quot;ts&quot;</span><span class="p">,</span> <span class="n">ct</span><span class="o">.</span><span class="n">c_ulonglong</span><span class="p">),</span>
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a>                <span class="p">(</span><span class="s2">&quot;comm&quot;</span><span class="p">,</span> <span class="n">ct</span><span class="o">.</span><span class="n">c_char</span> <span class="o">*</span> <span class="n">TASK_COMM_LEN</span><span class="p">)]</span><span class="s2">&quot;。def print_event(cpu, data, size):</span>
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a>    <span class="n">event</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ct</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">Data</span><span class="p">))</span><span class="o">.</span><span class="n">contents</span>
<a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="p">[</span><span class="o">...</span><span class="p">]</span>
<a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a>
<a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a>
<a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="n">在此处的示例中</span><span class="err">：</span>
<a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a><span class="p">[</span><span class="n">code</span><span class="p">](</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">iovisor</span><span class="o">/</span><span class="n">bcc</span><span class="o">/</span><span class="n">blob</span><span class="o">/</span><span class="n">v0</span><span class="mf">.9.0</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">hello_perf_output</span><span class="o">.</span><span class="n">py</span><span class="c1">#L52),</span>
<a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a><span class="p">[</span><span class="n">search</span> <span class="o">/</span><span class="n">examples</span><span class="p">](</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">iovisor</span><span class="o">/</span><span class="n">bcc</span><span class="o">/</span><span class="n">tree</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">examples</span><span class="p">),</span>
<a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a><span class="p">[</span><span class="n">search</span> <span class="o">/</span><span class="n">tools</span><span class="p">](</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">iovisor</span><span class="o">/</span><span class="n">bcc</span><span class="o">/</span><span class="n">tree</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">tools</span><span class="p">)</span>
<a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a>
<a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a><span class="c1">### 3. items()</span>
<a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a>
<a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a><span class="n">语法</span><span class="p">:</span> <span class="err">```</span><span class="n">table</span><span class="o">.</span><span class="n">items</span><span class="p">()</span><span class="err">```</span>
<a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a>
<a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a><span class="n">返回一个表中的键数组</span><span class="err">。</span><span class="n">它可以与BPF_HASH映射一起使用</span><span class="err">，</span><span class="n">从而获取并迭代键</span><span class="err">。</span>
<a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a>
<a id="__codelineno-65-22" name="__codelineno-65-22" href="#__codelineno-65-22"></a><span class="n">示例</span><span class="p">:</span>
<a id="__codelineno-65-23" name="__codelineno-65-23" href="#__codelineno-65-23"></a>
<a id="__codelineno-65-24" name="__codelineno-65-24" href="#__codelineno-65-24"></a><span class="err">```</span><span class="n">Python</span>
<a id="__codelineno-65-25" name="__codelineno-65-25" href="#__codelineno-65-25"></a><span class="c1"># 打印输出</span>
<a id="__codelineno-65-26" name="__codelineno-65-26" href="#__codelineno-65-26"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%10s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;COUNT&quot;</span><span class="p">,</span> <span class="s2">&quot;STRING&quot;</span><span class="p">))</span>
<a id="__codelineno-65-27" name="__codelineno-65-27" href="#__codelineno-65-27"></a><span class="n">counts</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="s2">&quot;counts&quot;</span><span class="p">)</span>
<a id="__codelineno-65-28" name="__codelineno-65-28" href="#__codelineno-65-28"></a><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">counts</span><span class="p">:</span> <span class="n">counts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
<a id="__codelineno-65-29" name="__codelineno-65-29" href="#__codelineno-65-29"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%10d</span><span class="s2"> </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;string-escape&#39;</span><span class="p">)))</span>
</code></pre></div>
<p>此示例还使用<code>sorted()</code>方法按值排序。</p>
<p>在此处的示例中：
<a href="https://github.com/iovisor/bcc/tree/master/examples">search /examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">search /tools</a>。</p>
<h3 id="4-values">4. values()</h3>
<p>语法: <code>table.values()</code></p>
<p>返回一个表中的值数组。</p>
<h3 id="5-clear">5. clear()</h3>
<p>语法: <code>table.clear()</code></p>
<p>清除表：删除所有条目。</p>
<p>示例:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="c1"># 每秒打印映射摘要：</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%-8s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a>    <span class="n">dist</span><span class="o">.</span><span class="n">print_log2_hist</span><span class="p">(</span><span class="n">sym</span> <span class="o">+</span> <span class="s2">&quot; return:&quot;</span><span class="p">)</span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a>    <span class="n">dist</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div>
<p>在此处的示例中:
<a href="https://github.com/iovisor/bcc/tree/master/examples">search /examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">search /tools</a>。</p>
<h3 id="6-items_lookup_and_delete_batch">6. items_lookup_and_delete_batch()</h3>
<p>语法: <code>table.items_lookup_and_delete_batch()</code>。返回一个使用一次BPF系统调用在表中的键的数组。可以与BPF_HASH映射一起使用以获取和迭代键。还会清除表：删除所有条目。
您应该使用table.items_lookup_and_delete_batch()而不是table.items()后跟table.clear()。它需要内核v5.6。</p>
<p>示例:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="c1"># 每秒打印调用率:</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%9s</span><span class="s2">-</span><span class="si">%9s</span><span class="s2">-</span><span class="si">%8s</span><span class="s2">-</span><span class="si">%9s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;PID&quot;</span><span class="p">,</span> <span class="s2">&quot;COMM&quot;</span><span class="p">,</span> <span class="s2">&quot;fname&quot;</span><span class="p">,</span> <span class="s2">&quot;counter&quot;</span><span class="p">))</span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items_lookup_and_delete_batch</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">kv</span><span class="p">:</span> <span class="p">(</span><span class="n">kv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">pid</span><span class="p">):</span>
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%9s</span><span class="s2">-</span><span class="si">%9s</span><span class="s2">-</span><span class="si">%8s</span><span class="s2">-</span><span class="si">%9d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">comm</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">counter</span><span class="p">))</span>
<a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a>    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<h3 id="7-items_lookup_batch">7. items_lookup_batch()</h3>
<p>语法: <code>table.items_lookup_batch()</code></p>
<p>使用一次BPF系统调用返回表中的键数组。可以与BPF_HASH映射一起使用以获取和迭代键。
您应该使用table.items_lookup_batch()而不是table.items()。它需要内核v5.6。</p>
<p>示例:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="c1"># 打印映射的当前值:</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%9s</span><span class="s2">-</span><span class="si">%9s</span><span class="s2">-</span><span class="si">%8s</span><span class="s2">-</span><span class="si">%9s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;PID&quot;</span><span class="p">,</span> <span class="s2">&quot;COMM&quot;</span><span class="p">,</span> <span class="s2">&quot;fname&quot;</span><span class="p">,</span> <span class="s2">&quot;counter&quot;</span><span class="p">))</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items_lookup_batch</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">kv</span><span class="p">:</span> <span class="p">(</span><span class="n">kv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">pid</span><span class="p">):</span>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%9s</span><span class="s2">-</span><span class="si">%9s</span><span class="s2">-</span><span class="si">%8s</span><span class="s2">-</span><span class="si">%9d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">comm</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">counter</span><span class="p">))</span>
</code></pre></div>
<h3 id="8-items_delete_batch">8. items_delete_batch()</h3>
<p>语法: <code>table.items_delete_batch(keys)</code></p>
<p>当keys为None时，它会清除BPF_HASH映射的所有条目。它比table.clear()更有效，因为它只生成一个系统调用。您可以通过给出一个键数组来删除映射的一个子集。这些键及其关联值将被删除。它需要内核v5.6。</p>
<p>参数:</p>
<ul>
<li>keys是可选的，默认为None。</li>
</ul>
<h3 id="9-items_update_batch">9. items_update_batch()</h3>
<p>语法: <code>table.items_update_batch(keys, values)</code></p>
<p>使用新值更新所有提供的键。两个参数必须具有相同的长度并且在映射限制之内（在1到最大条目之间）。它需要内核v5.6。</p>
<p>参数:</p>
<ul>
<li>keys是要更新的键列表</li>
<li>values是包含新值的列表。### 10. print_log2_hist()</li>
</ul>
<p>语法: <code>table.print_log2_hist(val_type="value", section_header="Bucket ptr", section_print_fn=None)</code></p>
<p>以ASCII的形式打印一个表格作为log2直方图。该表必须以log2的形式存储，可使用BPF函数<code>bpf_log2l()</code>完成。</p>
<p>参数:</p>
<ul>
<li>val_type: 可选，列标题。</li>
<li>section_header: 如果直方图有一个辅助键，多个表格将被打印，并且section_header可以用作每个表格的标题描述。</li>
<li>section_print_fn: 如果section_print_fn不为None，则将传递给bucket值。</li>
</ul>
<p>示例:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="n">b</span> <span class="o">=</span> <span class="n">BPF</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="s2">BPF_HISTOGRAM(dist);</span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="s2">int kprobe__blk_account_io_done(struct pt_regs *ctx, struct request *req)</span>
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="s2">{</span>
<a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="s2"> dist.increment(bpf_log2l(req-&gt;__data_len / 1024));</span>
<a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a><span class="s2"> return 0;</span>
<a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a><span class="s2">}</span>
<a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a><span class="p">[</span><span class="o">...</span><span class="p">]</span>
<a id="__codelineno-69-11" name="__codelineno-69-11" href="#__codelineno-69-11"></a>
<a id="__codelineno-69-12" name="__codelineno-69-12" href="#__codelineno-69-12"></a><span class="n">b</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">print_log2_hist</span><span class="p">(</span><span class="s2">&quot;kbytes&quot;</span><span class="p">)</span>
</code></pre></div>
<p>输出:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="w">     </span>kbytes<span class="w">          </span>:<span class="w"> </span>count<span class="w">     </span>distribution
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="w">       </span><span class="m">0</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">1</span><span class="w">        </span>:<span class="w"> </span><span class="m">3</span><span class="w">        </span><span class="p">|</span><span class="w">                                      </span><span class="p">|</span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="w">       </span><span class="m">2</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">3</span><span class="w">        </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                      </span><span class="p">|</span>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="w">       </span><span class="m">4</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">7</span><span class="w">        </span>:<span class="w"> </span><span class="m">211</span><span class="w">      </span><span class="p">|</span>**********<span class="w">                            </span><span class="p">|</span>
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="w">       </span><span class="m">8</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">15</span><span class="w">       </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                      </span><span class="p">|</span>
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="w">      </span><span class="m">16</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">31</span><span class="w">       </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                      </span><span class="p">|</span>
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="w">      </span><span class="m">32</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">63</span><span class="w">       </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                      </span><span class="p">|</span>
<a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="w">      </span><span class="m">64</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">127</span><span class="w">      </span>:<span class="w"> </span><span class="m">1</span><span class="w">        </span><span class="p">|</span><span class="w">                                      </span><span class="p">|</span>
<a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a><span class="w">     </span><span class="m">128</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="m">255</span><span class="w">      </span>:<span class="w"> </span><span class="m">800</span><span class="w">      </span><span class="p">|</span>**************************************<span class="p">|</span>
</code></pre></div>
<p>这个输出显示了一个多模式分布，最大模式是128-&gt;255 kbytes，计数为800。</p>
<p>这是一种高效的数据概括方法，因为概括是在内核中执行的，只有计数列被传递到用户空间。</p>
<p>实际示例:
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /tools</a></p>
<h3 id="11-print_linear_hist-tableprint_linear_histval_typevalue-section_headerbucket-ptr-section_print_fnnone">11. print_linear_hist()".语法: <code>table.print_linear_hist(val_type="value", section_header="Bucket ptr", section_print_fn=None)</code></h3>
<p>以ASCII字符形式打印一个线性直方图的表格。此功能旨在可视化小的整数范围，例如0到100。</p>
<p>参数:</p>
<ul>
<li>val_type: 可选，列标题。</li>
<li>section_header: 如果直方图有一个二级键，则会打印多个表格，并且section_header可以用作每个表格的头部描述。</li>
<li>section_print_fn: 如果section_print_fn不为None，则会将bucket的值传递给它。</li>
</ul>
<p>示例:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="n">b</span> <span class="o">=</span> <span class="n">BPF</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="s2">BPF_HISTOGRAM(dist);</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="s2">int kprobe__blk_account_io_done(struct pt_regs *ctx, struct request *req)</span>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="s2">{</span>
<a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="s2"> dist.increment(req-&gt;__data_len / 1024);</span>
<a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="s2"> return 0;</span>
<a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="s2">}</span>
<a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a><span class="p">[</span><span class="o">...</span><span class="p">]</span>
<a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a>
<a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a><span class="n">b</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">print_linear_hist</span><span class="p">(</span><span class="s2">&quot;kbytes&quot;</span><span class="p">)</span>
</code></pre></div>
<p>输出:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="w">     </span>kbytes<span class="w">        </span>:<span class="w"> </span>count<span class="w">     </span>distribution
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="w">        </span><span class="m">0</span><span class="w">          </span>:<span class="w"> </span><span class="m">3</span><span class="w">        </span><span class="p">|</span>******<span class="w">                                  </span><span class="p">|</span>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="w">        </span><span class="m">1</span><span class="w">          </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="w">        </span><span class="m">2</span><span class="w">          </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="w">        </span><span class="m">3</span><span class="w">          </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="w">        </span><span class="m">4</span><span class="w">          </span>:<span class="w"> </span><span class="m">19</span><span class="w">       </span><span class="p">|</span>****************************************<span class="p">|</span>
<a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a><span class="w">        </span><span class="m">5</span><span class="w">          </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a><span class="w">        </span><span class="m">6</span><span class="w">          </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a><span class="w">        </span><span class="m">7</span><span class="w">          </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a><span class="w">        </span><span class="m">8</span><span class="w">          </span>:<span class="w"> </span><span class="m">4</span><span class="w">        </span><span class="p">|</span>********<span class="w">                                </span><span class="p">|</span>
<a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a><span class="w">        </span><span class="m">9</span><span class="w">          </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-72-12" name="__codelineno-72-12" href="#__codelineno-72-12"></a><span class="w">        </span><span class="m">10</span><span class="w">         </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-72-13" name="__codelineno-72-13" href="#__codelineno-72-13"></a><span class="w">        </span><span class="m">11</span><span class="w">         </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-72-14" name="__codelineno-72-14" href="#__codelineno-72-14"></a><span class="w">        </span><span class="m">12</span><span class="w">         </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-72-15" name="__codelineno-72-15" href="#__codelineno-72-15"></a><span class="w">        </span><span class="m">13</span><span class="w">         </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-72-16" name="__codelineno-72-16" href="#__codelineno-72-16"></a><span class="w">        </span><span class="m">14</span><span class="w">         </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-72-17" name="__codelineno-72-17" href="#__codelineno-72-17"></a><span class="w">        </span><span class="m">15</span><span class="w">         </span>:<span class="w"> </span><span class="m">0</span><span class="w">        </span><span class="p">|</span><span class="w">                                        </span><span class="p">|</span>。
<a id="__codelineno-72-18" name="__codelineno-72-18" href="#__codelineno-72-18"></a><span class="sb">```</span><span class="c1">### 16         : 2        |****                                    |</span>
<a id="__codelineno-72-19" name="__codelineno-72-19" href="#__codelineno-72-19"></a><span class="o">[</span>...<span class="o">]</span>
</code></pre></div>
<p>这是一种高效的数据汇总方式，因为汇总是在内核中执行的，只有计数列中的值传递到用户空间。</p>
<p>现场示例:
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /tools</a></p>
<h3 id="12-open_ring_buffer">12. open_ring_buffer()</h3>
<p>语法: <code>table.open_ring_buffer(callback, ctx=None)</code></p>
<p>此操作用于在BPF中定义为BPF_RINGBUF_OUTPUT()的表，并将Python回调函数<code>callback</code>与ringbuf环形缓冲区中有可用数据时调用相连。这是从内核向用户空间传输每个事件数据的新（Linux 5.8+）推荐机制的一部分。不同于perf缓冲区，ringbuf大小在BPF程序中指定，作为<code>BPF_RINGBUF_OUTPUT</code>宏的一部分。如果回调函数处理数据不够快，可能会丢失一些提交的数据。在这种情况下，事件应该更频繁地进行轮询和/或增加环形缓冲区的大小。</p>
<p>示例:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="c1"># 处理事件</span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="k">def</span> <span class="nf">print_event</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>    <span class="n">event</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ct</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">Data</span><span class="p">))</span><span class="o">.</span><span class="n">contents</span>
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a>    <span class="p">[</span><span class="o">...</span><span class="p">]</span>
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a>
<a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="c1"># 循环并使用print_event回调函数</span>
<a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="n">b</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">open_ring_buffer</span><span class="p">(</span><span class="n">print_event</span><span class="p">)</span>
<a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a>        <span class="n">b</span><span class="o">.</span><span class="n">ring_buffer_poll</span><span class="p">()</span>
<a id="__codelineno-73-11" name="__codelineno-73-11" href="#__codelineno-73-11"></a>    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<a id="__codelineno-73-12" name="__codelineno-73-12" href="#__codelineno-73-12"></a>        <span class="n">exit</span><span class="p">()</span>
</code></pre></div>
<p>请注意，在BPF程序中，传输的数据结构需要在C中声明。例如:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="c1">// 在C中定义输出数据结构</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">data_t</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="w">    </span><span class="n">u32</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="w">    </span><span class="n">u64</span><span class="w"> </span><span class="n">ts</span><span class="p">;</span>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">comm</span><span class="p">[</span><span class="n">TASK_COMM_LEN</span><span class="p">];</span>
<a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="p">};</span>
<a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="n">BPF_RINGBUF_OUTPUT</span><span class="p">(</span><span class="n">events</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
<a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="p">[...]</span>
</code></pre></div>
<p>在Python中，您可以让bcc自动从C的声明中生成数据结构（推荐）:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="k">def</span> <span class="nf">print_event</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>    <span class="n">event</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="p">[</span><span class="o">...</span><span class="p">]</span>
</code></pre></div>
<p>或者手动定义:</p>
<p>```Python".# 在Python中定义输出数据结构
TASK_COMM_LEN = 16    # linux/sched.h
class Data(ct.Structure):
    <em>fields</em> = [("pid", ct.c_ulonglong),
                ("ts", ct.c_ulonglong),
                ("comm", ct.c_char * TASK_COMM_LEN)]</p>
<p>def print_event(ctx, data, size):
    event = ct.cast(data, ct.POINTER(Data)).contents
[...]</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>在原地的示例:
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>[在/examples中搜索](https://github.com/iovisor/bcc/tree/master/examples),
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>### 13. push()
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a>
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a>语法: ```table.push(leaf, flags=0)```
<a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a>
<a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a>将元素推入堆栈或队列表。如果操作不成功，会引发异常。传递QueueStack.BPF_EXIST作为标志会使队列或堆栈丢弃最旧的元素，如果表已满。
<a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a>
<a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a>在原地的示例:
<a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a>[在/tests中搜索](https://github.com/iovisor/bcc/tree/master/tests),
<a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a>
<a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a>### 14. pop()
<a id="__codelineno-76-14" name="__codelineno-76-14" href="#__codelineno-76-14"></a>
<a id="__codelineno-76-15" name="__codelineno-76-15" href="#__codelineno-76-15"></a>语法: ```leaf = table.pop()```
<a id="__codelineno-76-16" name="__codelineno-76-16" href="#__codelineno-76-16"></a>
<a id="__codelineno-76-17" name="__codelineno-76-17" href="#__codelineno-76-17"></a>从堆栈或队列表中弹出一个元素。与```peek()```不同，```pop()```在返回元素之前会将其从表中移除。如果操作不成功，会引发KeyError异常。
<a id="__codelineno-76-18" name="__codelineno-76-18" href="#__codelineno-76-18"></a>
<a id="__codelineno-76-19" name="__codelineno-76-19" href="#__codelineno-76-19"></a>在原地的示例:
<a id="__codelineno-76-20" name="__codelineno-76-20" href="#__codelineno-76-20"></a>[在/tests中搜索](https://github.com/iovisor/bcc/tree/master/tests),
<a id="__codelineno-76-21" name="__codelineno-76-21" href="#__codelineno-76-21"></a>
<a id="__codelineno-76-22" name="__codelineno-76-22" href="#__codelineno-76-22"></a>### 15. peek()
<a id="__codelineno-76-23" name="__codelineno-76-23" href="#__codelineno-76-23"></a>
<a id="__codelineno-76-24" name="__codelineno-76-24" href="#__codelineno-76-24"></a>语法: ```leaf = table.peek()```
<a id="__codelineno-76-25" name="__codelineno-76-25" href="#__codelineno-76-25"></a>
<a id="__codelineno-76-26" name="__codelineno-76-26" href="#__codelineno-76-26"></a>查看堆栈或队列表头部的元素。与```pop()```不同，```peek()```不会将元素从表中移除。如果操作不成功，会引发异常。
<a id="__codelineno-76-27" name="__codelineno-76-27" href="#__codelineno-76-27"></a>
<a id="__codelineno-76-28" name="__codelineno-76-28" href="#__codelineno-76-28"></a>在原地的示例:
<a id="__codelineno-76-29" name="__codelineno-76-29" href="#__codelineno-76-29"></a>[在/tests中搜索](https://github.com/iovisor/bcc/tree/master/tests),
<a id="__codelineno-76-30" name="__codelineno-76-30" href="#__codelineno-76-30"></a>
<a id="__codelineno-76-31" name="__codelineno-76-31" href="#__codelineno-76-31"></a>## 辅助方法
<a id="__codelineno-76-32" name="__codelineno-76-32" href="#__codelineno-76-32"></a>
<a id="__codelineno-76-33" name="__codelineno-76-33" href="#__codelineno-76-33"></a>一些由bcc提供的辅助方法。请注意，因为我们在Python中，我们可以导入任何Python库及其方法，包括例如argparse、collections、ctypes、datetime、re、socket、struct、subprocess、sys和time等库。
<a id="__codelineno-76-34" name="__codelineno-76-34" href="#__codelineno-76-34"></a>
<a id="__codelineno-76-35" name="__codelineno-76-35" href="#__codelineno-76-35"></a>### 1. ksym()
<a id="__codelineno-76-36" name="__codelineno-76-36" href="#__codelineno-76-36"></a>
<a id="__codelineno-76-37" name="__codelineno-76-37" href="#__codelineno-76-37"></a>语法: ```BPF.ksym(addr)```
<a id="__codelineno-76-38" name="__codelineno-76-38" href="#__codelineno-76-38"></a>
<a id="__codelineno-76-39" name="__codelineno-76-39" href="#__codelineno-76-39"></a>将内核内存地址转换为内核函数名称，并返回该名称。
<a id="__codelineno-76-40" name="__codelineno-76-40" href="#__codelineno-76-40"></a>
<a id="__codelineno-76-41" name="__codelineno-76-41" href="#__codelineno-76-41"></a>示例:
<a id="__codelineno-76-42" name="__codelineno-76-42" href="#__codelineno-76-42"></a>
<a id="__codelineno-76-43" name="__codelineno-76-43" href="#__codelineno-76-43"></a>```Python&quot;。
<a id="__codelineno-76-44" name="__codelineno-76-44" href="#__codelineno-76-44"></a>格式: 只返回转换后的内容，不包括原始文本。```markdown
<a id="__codelineno-76-45" name="__codelineno-76-45" href="#__codelineno-76-45"></a>print(&quot;内核函数：&quot; + b.ksym(addr))
</code></pre></div>
<p>例子：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /tools</a></p>
<h3 id="2-ksymname">2. ksymname()</h3>
<p>语法：<code>BPF.ksymname(name)</code></p>
<p>将内核名称翻译为地址。这是ksym的反向过程。当函数名称未知时，返回-1。</p>
<p>例子：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;内核地址：</span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">b</span><span class="o">.</span><span class="n">ksymname</span><span class="p">(</span><span class="s2">&quot;vfs_read&quot;</span><span class="p">))</span>
</code></pre></div>
<p>例子：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /tools</a></p>
<h3 id="3-sym">3. sym()</h3>
<p>语法：<code>BPF.sym(addr, pid, show_module=False, show_offset=False)</code></p>
<p>将内存地址翻译为pid的函数名称，并返回。小于零的pid将访问内核符号缓存。<code>show_module</code>和<code>show_offset</code>参数控制是否显示函数所在的模块以及是否显示从符号开头的指令偏移量。这些额外参数的默认值为<code>False</code>。</p>
<p>例子：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;函数：&quot;</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">pid</span><span class="p">))</span>
</code></pre></div>
<p>例子：
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /examples</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /tools</a></p>
<h3 id="4-num_open_kprobes">4. num_open_kprobes()</h3>
<p>语法：<code>BPF.num_open_kprobes()</code></p>
<p>返回打开的k[ret]probe的数量。当使用event_re附加和分离探测点时，可以发挥作用。不包括perf_events读取器。</p>
<p>例子：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="n">b</span><span class="o">.</span><span class="n">attach_kprobe</span><span class="p">(</span><span class="n">event_re</span><span class="o">=</span><span class="n">pattern</span><span class="p">,</span> <span class="n">fn_name</span><span class="o">=</span><span class="s2">&quot;trace_count&quot;</span><span class="p">)</span>
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="n">matched</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">num_open_kprobes</span><span class="p">()</span>
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="k">if</span> <span class="n">matched</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;0个函数与</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">匹配。程序退出。&quot;</span> <span class="o">%</span> <span class="n">args</span><span class="o">.</span><span class="n">pattern</span><span class="p">)</span>
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a>    <span class="n">exit</span><span class="p">()</span>
</code></pre></div>
<p>例子："<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /示例</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /工具</a></p>
<h3 id="5-get_syscall_fnname">5. get_syscall_fnname()</h3>
<p>语法: <code>BPF.get_syscall_fnname(name : str)</code></p>
<p>返回系统调用的相应内核函数名。该辅助函数将尝试不同的前缀，并与系统调用名连接起来。请注意，返回值可能在不同版本的Linux内核中有所不同，有时会引起问题。 （见 <a href="https://github.com/iovisor/bcc/issues/2590">#2590</a>）</p>
<p>示例:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;在内核中，</span><span class="si">%s</span><span class="s2"> 的函数名是 </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;clone&quot;</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">get_syscall_fnname</span><span class="p">(</span><span class="s2">&quot;clone&quot;</span><span class="p">)))</span>
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="c1"># sys_clone 或 __x64_sys_clone 或 ...</span>
</code></pre></div>
<p>现场示例:
<a href="https://github.com/iovisor/bcc/tree/master/examples">搜索 /示例</a>,
<a href="https://github.com/iovisor/bcc/tree/master/tools">搜索 /工具</a></p>
<h1 id="bpf">BPF 错误</h1>
<p>请参阅内核源码中的“Understanding eBPF verifier messages”部分，位于 Documentation/networking/filter.txt。</p>
<h2 id="1-invalid-mem-access">1. Invalid mem access</h2>
<p>这可能是因为试图直接读取内存，而不是操作BPF堆栈上的内存。所有对内核内存的读取必须通过 bpf_probe_read_kernel() 传递，以将内核内存复制到BPF堆栈中，在一些简单关联的情况下，bcc 重写器可以自动完成。bpf_probe_read_kernel() 执行所有必要的检查。</p>
<p>示例:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>bpf:<span class="w"> </span>Permission<span class="w"> </span>denied
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="m">0</span>:<span class="w"> </span><span class="o">(</span>bf<span class="o">)</span><span class="w"> </span><span class="nv">r6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>r1
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="m">1</span>:<span class="w"> </span><span class="o">(</span><span class="m">79</span><span class="o">)</span><span class="w"> </span><span class="nv">r7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>*<span class="o">(</span>u64<span class="w"> </span>*<span class="o">)(</span>r6<span class="w"> </span>+80<span class="o">)</span>
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="m">2</span>:<span class="w"> </span><span class="o">(</span><span class="m">85</span><span class="o">)</span><span class="w"> </span>call<span class="w"> </span><span class="m">14</span>
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="m">3</span>:<span class="w"> </span><span class="o">(</span>bf<span class="o">)</span><span class="w"> </span><span class="nv">r8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>r0
<a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="o">[</span>...<span class="o">]</span>
<a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a><span class="m">23</span>:<span class="w"> </span><span class="o">(</span><span class="m">69</span><span class="o">)</span><span class="w"> </span><span class="nv">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>*<span class="o">(</span>u16<span class="w"> </span>*<span class="o">)(</span>r7<span class="w"> </span>+16<span class="o">)</span>
<a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a>R7<span class="w"> </span>invalid<span class="w"> </span>mem<span class="w"> </span>access<span class="w"> </span><span class="s1">&#39;inv&#39;</span>
<a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a>
<a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a>Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a><span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;./tcpaccept&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">179</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
<a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a><span class="w">    </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>BPF<span class="o">(</span><span class="nv">text</span><span class="o">=</span>bpf_text<span class="o">)</span>
<a id="__codelineno-81-13" name="__codelineno-81-13" href="#__codelineno-81-13"></a><span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;/usr/lib/python2.7/dist-packages/bcc/__init__.py&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">172</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>__init__
<a id="__codelineno-81-14" name="__codelineno-81-14" href="#__codelineno-81-14"></a><span class="w">    </span>self._trace_autoload<span class="o">()</span><span class="s2">&quot;.</span>
<a id="__codelineno-81-15" name="__codelineno-81-15" href="#__codelineno-81-15"></a><span class="s2">/usr/lib/python2.7/dist-packages/bcc/__init__.py&quot;</span>，第<span class="w"> </span><span class="m">612</span><span class="w"> </span>行，_trace_autoload<span class="w"> </span>中：
<a id="__codelineno-81-16" name="__codelineno-81-16" href="#__codelineno-81-16"></a><span class="w">    </span><span class="nv">fn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>self.load_func<span class="o">(</span>func_name,<span class="w"> </span>BPF.KPROBE<span class="o">)</span>
<a id="__codelineno-81-17" name="__codelineno-81-17" href="#__codelineno-81-17"></a><span class="w">  </span>文件<span class="w"> </span><span class="s2">&quot;/usr/lib/python2.7/dist-packages/bcc/__init__.py&quot;</span>，第<span class="w"> </span><span class="m">212</span><span class="w"> </span>行，load_func<span class="w"> </span>中：
<a id="__codelineno-81-18" name="__codelineno-81-18" href="#__codelineno-81-18"></a><span class="w">    </span>raise<span class="w"> </span>Exception<span class="o">(</span><span class="s2">&quot;加载 BPF 程序 %s 失败&quot;</span><span class="w"> </span>%<span class="w"> </span>func_name<span class="o">)</span>
<a id="__codelineno-81-19" name="__codelineno-81-19" href="#__codelineno-81-19"></a>Exception:<span class="w"> </span>加载<span class="w"> </span>BPF<span class="w"> </span>程序<span class="w"> </span>kretprobe__inet_csk_accept<span class="w"> </span>失败
</code></pre></div>
<h2 id="2-gpl-only">2. 无法从专有程序调用 GPL-only 函数</h2>
<p>当非 GPL BPF 程序调用 GPL-only 辅助函数时，会出现此错误。要修复此错误，请勿在专有 BPF 程序中使用 GPL-only 辅助函数，或者将 BPF 程序重新授权为 GPL-compatible 许可证。请查看哪些 <a href="https://github.com/iovisor/bcc/blob/master/docs/kernel-versions.md#helpers">BPF helpers</a> 是 GPL-only 的，并且哪些许可证被视为 GPL-compatible。</p>
<p>示例，从专有程序（<code>#define BPF_LICENSE Proprietary</code>）调用 <code>bpf_get_stackid()</code>，一种 GPL-only 的 BPF helper：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>bpf:<span class="w"> </span>加载程序失败：无效参数
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="o">[</span>...<span class="o">]</span>
<a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="m">8</span>:<span class="w"> </span><span class="o">(</span><span class="m">85</span><span class="o">)</span><span class="w"> </span>调用<span class="w"> </span>bpf_get_stackid#27
<a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a>无法从专有程序调用<span class="w"> </span>GPL-only<span class="w"> </span>函数
</code></pre></div>
<h1 id="_13">环境变量</h1>
<h2 id="1">1. 内核源代码目录</h2>
<p>eBPF 程序编译需要内核源代码或已编译的内核头。如果你的内核源代码位于无法被 BCC 找到的非标准位置，可以通过将 <code>BCC_KERNEL_SOURCE</code> 设置为该路径的绝对路径来为 BCC 提供所需的位置信息。</p>
<h2 id="2">2. 内核版本覆盖</h2>
<p>默认情况下，BCC 将 <code>LINUX_VERSION_CODE</code> 存储在生成的 eBPF 对象中，并在加载 eBPF 程序时传递给内核。有时，这可能非常不方便，尤其是当内核略有更新时，比如 LTS 内核发布。微小的不匹配几乎不会导致加载的 eBPF 程序出现任何问题。通过将 <code>BCC_LINUX_VERSION_CODE</code> 设置为正在运行的内核版本，可以绕过验证内核版本的检查。这对于程序是必需的。使用kprobes的程序需要以<code>(VERSION * 65536) + (PATCHLEVEL * 256) + SUBLEVEL</code>的格式进行编码。例如，如果当前运行的内核是<code>4.9.10</code>，则可以设置<code>export BCC_LINUX_VERSION_CODE=264458</code>以成功地覆盖内核版本检查。</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=bcc%20%E5%8F%82%E8%80%83%E6%8C%87%E5%8D%97%0A&amp;url=https://eunomia.dev/zh/tutorials/bcc-documents/reference_guide/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://eunomia.dev/zh/tutorials/bcc-documents/reference_guide/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="September 24, 2025 21:58:55 UTC">September 24, 2025</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="August 10, 2023 12:54:12 UTC">August 10, 2023</span>
  </span>

    
    
      
  
  <span class="md-source-file__fact">
    <span class="md-icon" title="Contributors">
      
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/></svg>
      
    </span>
    <nav>
      
        <a href="mailto:1067852565@qq.com">云微</a>
    </nav>
  </span>

    
    
  </aside>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/orgs/eunomia-bpf/discussions" target="_blank" rel="noopener">Github discussion</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


<script src="https://giscus.app/client.js"
        data-repo="eunomia-bpf/bpf-developer-tutorial"
        data-repo-id="R_kgDOIi0KhQ"
        data-category="General"
        data-category-id="DIC_kwDOIi0Khc4CYq-h"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>

                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../kernel_config/" class="md-footer__link md-footer__link--prev" aria-label="Previous: BPF 特性的内核配置">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                BPF 特性的内核配置
              </div>
            </div>
          </a>
        
        
          
          <a href="../special_filtering/" class="md-footer__link md-footer__link--next" aria-label="Next: 特殊过滤">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                特殊过滤
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright (c) 2025 eunomia-bpf org.
    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/eunomia-bpf" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:yunwei356@gmail.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M536.4-26.3c9.8-3.5 20.6-1 28 6.3s9.8 18.2 6.3 28l-178 496.9c-5 13.9-18.1 23.1-32.8 23.1-14.2 0-27-8.6-32.3-21.7l-64.2-158c-4.5-11-2.5-23.6 5.2-32.6l94.5-112.4c5.1-6.1 4.7-15-.9-20.6s-14.6-6-20.6-.9l-112.4 94.3c-9.1 7.6-21.6 9.6-32.6 5.2L38.1 216.8c-13.1-5.3-21.7-18.1-21.7-32.3 0-14.7 9.2-27.8 23.1-32.8z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["search.suggest", "search.highlight", "search.share", "navigation.footer", "navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.expand", "navigation.path", "navigation.top", "content.tabs.link", "content.action.edit"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
<script src="https://cdn.usefathom.com/script.js" data-site="ZLDAHRNN" defer></script>

      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    

  </body>
</html>